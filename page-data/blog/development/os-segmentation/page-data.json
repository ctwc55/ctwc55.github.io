{"componentChunkName":"component---src-templates-article-jsx","path":"/blog/development/os-segmentation","result":{"data":{"datoCmsMiscTextString":{"locale":"ko-KR","updatedAtText":"업데이트됨","nextReadText":"관련있는 게시물"},"datoCmsBlogPost":{"locale":"ko-KR","originalId":"177405298","title":"[운영체제][OSTEP] 세그멘테이션","seo":{"seoTitle":"[운영체제][OSTEP] 세그멘테이션","seoDescription":"대용량 주소 공간을 지원하는 방법에 대해 공부해봅니다.","seoImage":{"seoImageUrl":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format"}},"subtitle":"대용량 주소 공간을 지원하는 방법에 대해 공부해봅니다.","coverImage":{"coverImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&w=860","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.25&w=860 215w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.5&w=860 430w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&w=860 860w","sizes":"(min-width: 860px) 860px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLCgoLDhMVDhcNDh0VDxUSGhYdHSIVFhUaKysjGh0oHSEWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLCgUFEBAOEC8oIhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAwAGAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAFAQQGAP/EAB0QAAEEAgMAAAAAAAAAAAAAAAEAAgMEESEFEjL/xAAWAQADAAAAAAAAAAAAAAAAAAAAAQP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDD1KM1uPLjpIRUI4GZc4aRXH25hTOHqqbth7yDIVIiXI2IQzqCoREhL/RyuQH/2Q=="},"width":860,"height":430}},"meta":{"updatedAt":"2023-07-18T17:33:34.082+09:00","firstPublishedAt":"2023-07-18T15:58:56.254+09:00"},"categoryLink":{"title":"개발 공부","id":"4743072"},"author":{"authorName":"손승열(Son Seungyeol)","picture":{"authorPictureData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77","srcSet":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.2&w=77 15w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77 30w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77 60w","sizes":"(min-width: 60px) 60px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgWEQ8LDhgYDhUNDhgNDw8NFxUdGBYfFhUaHysjGikoHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OHBANHDUcIig7NS81NS81MjUvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAFAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAABQYHAv/EAB4QAAICAgMBAQAAAAAAAAAAAAABAgMFBgQRQXEi/8QAFQEBAQAAAAAAAAAAAAAAAAAABAP/xAAaEQACAwEBAAAAAAAAAAAAAAAAAQIDEhMR/9oADAMBAAIRAxEAPwDT8/1LHSK/r67scevSfz99VXBkm/Cva/zKle/pCc/JoRXWsFujxvygcLI1pAXqQTmjONm2RzpceyCwmwxpsbbADWJdBFbeCfe2wXoAGpIL6z//2Q=="},"width":60,"height":60}}},"relatedPosts":[{"id":"176854321","meta":{"updatedAt":"2023-07-18T17:02:12.468+09:00"},"categoryLink":{"title":"개발 공부"},"coverImage":{"gatsbyImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.35&w=860","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.09&w=860 75w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.18&w=860 150w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.35&w=860 300w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.7&w=860 600w","sizes":"(min-width: 300px) 300px, 100vw"}},"layout":"constrained","width":300,"height":120},"squaredImage":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.24&fit=crop&fp-x=0.5&fp-y=0.5&w=430","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.06&fit=crop&fp-x=0.5&fp-y=0.5&w=430 25w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.12&fit=crop&fp-x=0.5&fp-y=0.5&w=430 50w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.24&fit=crop&fp-x=0.5&fp-y=0.5&w=430 100w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.47&fit=crop&fp-x=0.5&fp-y=0.5&w=430 200w","sizes":"(min-width: 100px) 100px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBhINEBAQCggUDg0IDgcHFh0JFhEYFxUZGCIVFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OEg4REC8dFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAGAMBIgACEQEDEQH/xAAaAAEBAAIDAAAAAAAAAAAAAAAABAUGAQID/8QAHRAAAgICAwEAAAAAAAAAAAAAAAIDBAEREhQVBf/EABYBAQEBAAAAAAAAAAAAAAAAAAADAf/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/ANASs2WLoaraMl1o0O241wSYlSHjgHM9hVAEFr6bKSemzAAeclpnAAH/2Q=="},"width":100,"height":100}},"author":{"authorName":"손승열(Son Seungyeol)","picture":{"authorImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77","srcSet":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.11&w=77 8w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.2&w=77 15w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77 30w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77 60w","sizes":"(min-width: 30px) 30px, 100vw"}},"layout":"constrained","width":30,"height":30}}},"subtitle":"효율적이고 유연하게 메모리를 가상화하는 방법에 대해 공부해봅니다.","title":"[운영체제][OSTEP] 주소 변환의 원리"}],"structuredBody":{"blocks":[],"links":[],"value":{"schema":"dast","document":{"type":"root","children":[{"type":"heading","level":2,"children":[{"type":"span","value":"1️⃣ 세그멘테이션: 베이스/바운드(base/bound)의 일반화"}]},{"type":"paragraph","children":[{"type":"span","value":"💡아이디어\nMMU 안에 오직 하나의 베이스와 바운드 쌍만 존재하는 것이 아니라 주소 공간의 논리적인 "},{"type":"span","marks":["highlight"],"value":"세그멘트(segment)"},{"type":"span","value":"마다 베이스와 바운드 쌍이 존재"}]},{"type":"paragraph","children":[{"type":"span","value":"📏 세그멘트 = 특정 길이를 가지는 연속적인 주소 공간"}]},{"type":"paragraph","children":[{"type":"span","value":"코드, 스택, 힙 세 종류의 세그멘트\n➡️ "},{"type":"span","marks":["highlight"],"value":"세그멘테이션"},{"type":"span","value":"을 사용하면 운영체제는 "},{"type":"span","marks":["highlight"],"value":"각 세그멘트를 물리 메모리의 각기 다른 위치에 배치"},{"type":"span","value":"할 수 있음 + "},{"type":"span","marks":["highlight"],"value":"사용되지 않는 가상 주소 공간이 물리 메모리를 차지하는 것을 방지"}]},{"type":"paragraph","children":[{"type":"span","value":"다음의 예시와 함께 이를 살펴보자."}]},{"code":" 0 KB ┌──────────────────────┐\n      │                      │\n 1 KB │                      │\n      │     Program Code     │\n 2 KB ├──────────────────────┤\n      │                      │\n 3 KB │                      │\n      │                      │\n 4 KB ├──────────────────────┤\n      │                      │\n 5 KB │         Heap         │\n      │                      │\n 6 KB ├──────────────────────┤\n      │          │           │\n      │          │           │\n      │          │           │\n      │          ↓           │\n      │        (free)        │\n      │          ↑           │\n      │          │           │\n      │          │           │\n      │          │           │\n14 KB ├──────────────────────┤\n      │                      │\n15 KB │        Stack         │\n      │                      │\n16 KB └──────────────────────┘","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"위의 주소 공간을 물리 메모리에 배치하려고 한다. "},{"type":"span","marks":["highlight"],"value":"각 세그먼트의 베이스와 바운드 쌍을 이용"},{"type":"span","value":"하여 세그멘트들을 다음과 같이 "},{"type":"span","marks":["highlight"],"value":"독립적으로 물리 메모리에 배치"},{"type":"span","value":"할 수 있다."}]},{"code":" 0 KB ┌──────────────────────┐\n      │                      │\n      │                      │\n      │   Operating System   │\n      │                      │\n      │                      │\n16 KB ├──────────────────────┤\n      │                      │\n      │     (not in use)     │\n      │          ↑           │\n      ├──────────────────────┤\n      │        Stack         │\n      ├──────────────────────┤\n      │     (not in use)     │\n32 KB ├──────────────────────┤\n      │         Code         │\n      ├──────────────────────┤\n      │         Heap         │\n      ├──────────────────────┤\n      │          ↓           │\n      │                      │\n48 KB │                      │\n      │                      │\n      │     (not in use)     │\n      │                      │\n      │                      │\n      │                      │\n64 KB └──────────────────────┘","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"위의 예시에서 확인할 수 있듯이, 사용 중인 메모리에만 물리 공간이 할당된다.\n➡️ 사용되지 않은 영역이 많은 대형 주소 공간("},{"type":"span","marks":["highlight"],"value":"sparse address space"},{"type":"span","value":"라고도 부름)을 수용할 수 있다."}]},{"type":"paragraph","children":[{"type":"span","value":"위의 경우 3쌍의 베이스와 바운드 레지스터 집합이 필요하며 이는 다음과 같이 나타낼 수 있다."}]},{"code":"Segment     Base     Size\n──────────────────────────\nCode        32K      2K\nHeap        34K      3K\nStack       28K      2K","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"이때, "},{"type":"span","marks":["underline"],"value":"가상 주소 100번지를 참조"},{"type":"span","value":"한다고 가정해보자."}]},{"type":"paragraph","children":[{"type":"span","value":"첫 번째 그림에서 100번지는 코드 세그멘트에 속하므로 참조가 일어나면 하드웨어는 베이스 값(32KB)에 이 세그멘트의 오프셋(100)을 더해 물리 주소 32868(100+32KB)을 얻어낸다."}]},{"type":"paragraph","children":[{"type":"span","value":"그 후, 주소가 범위 내에 있는지 검사(100 < 2KB)하고, 범위 내에 있을 경우 물리 메모리 주소 32868을 읽는다."}]},{"type":"paragraph","children":[{"type":"span","marks":["underline"],"value":"가상 주소 4200번지를 참조"},{"type":"span","value":"하는 경우를 다시 가정해보자."}]},{"type":"paragraph","children":[{"type":"span","value":"4200번지는 힙 세그먼트에 속하므로 베이스 값(34KB)에 오프셋(4200-4096(힙은 가상 주소가 4KB에서 시작하므로!))을 더하여 34920(104+34KB)을 얻게 된다."}]},{"type":"paragraph","children":[{"type":"span","marks":["underline"],"value":"힙의 마지막을 벗어난 7KB와 같은 잘못된 주소를 접근"},{"type":"span","value":"하는 경우를 가정해보자."}]},{"type":"paragraph","children":[{"type":"span","value":"⛔ 하드웨어가 그 주소가 범위를 벗어났다는 것을 감지하고 운영체제에 트랩을 발생\n➡️ "},{"type":"span","marks":["highlight"],"value":"세그멘트 폴트(segment fault)"},{"type":"span","value":"가 발생"}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"2️⃣ 세그멘트 종류의 파악"}]},{"type":"paragraph","children":[{"type":"span","value":"하드웨어는 변환을 위해 "},{"type":"span","marks":["highlight"],"value":"세그멘트 레지스터"},{"type":"span","value":"를 사용"}]},{"type":"paragraph","children":[{"type":"span","value":"가상 주소가 참조하는 세그멘트와 세그멘트 내 오프셋의 크기를 알아내는 일반적인 접근법\n➡️ "},{"type":"span","marks":["highlight"],"value":"가상 주소의 최상위 몇 비트를 기준으로 주소 공간을 여러 세그멘트로 나누는 것\n"},{"type":"span","value":"➡️ VAX/VMS 시스템에서 사용된 기법"}]},{"type":"paragraph","children":[{"type":"span","value":"1️⃣의 예시에서는 3개의 세그멘트가 존재 ➡️ 주소 공간을 세그멘트로 나누기 위해 2비트가 필요"}]},{"type":"paragraph","children":[{"type":"span","value":"세그멘트 표시를 위해 가상 주소 14비트 중 최상위 2비트를 사용하는 경우 가상 주소의 모양은 다음과 같다."}]},{"code":" 13 12 11 10  9  8  7  6  5  4  3  2  1  0\n┌──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┐\n└──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┘\n└─────┴───────────────────────────────────┘\nSegment              Offset","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"최상위 2비트의 세그멘트 표기는 다음과 같이 나타낼 수 있다."}]},{"type":"list","style":"bulleted","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"00: 코드 세그멘트"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"01: 힙 세그멘트"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"10: 스택 세그멘트"}]}]}]},{"type":"paragraph","children":[{"type":"span","value":"따라서 최상위 2비트의 "},{"type":"span","marks":["highlight"],"value":"세그멘트 표기를 통해 하드웨어는 그에 해당하는 베이스와 바운드를 사용"},{"type":"span","value":"할 수 있다."}]},{"type":"paragraph","children":[{"type":"span","value":"예를 들어, 위의 예시 중 "},{"type":"span","marks":["underline"],"value":"가상 주소 4200번지를 참조"},{"type":"span","value":"하는 경우 그에 해당하는 이진 형식은 다음과 같다."}]},{"code":"13 12 11 10  9  8  7  6  5  4  3  2  1  0\n┌────────────────────────────────────────┐\n 0  1  0  0  0  0  0  1  1  0  1  0  0  0\n└────────────────────────────────────────┘\n└────┴───────────────────────────────────┘\nSegment              Offset","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"하드웨어는 최상위 2비트 01을 통해 힙 세그먼트를, 하위 12비트 0000 0110 1000을 통해 오프셋 100을 알아낼 수 있다."}]},{"type":"paragraph","children":[{"type":"span","marks":["highlight"],"value":"오프셋은 바운드 검사도 쉽게 만듦."},{"type":"span","value":"\n➡️ "},{"type":"span","marks":["underline"],"value":"오프셋이 바운드 보다 작은지 여부만 검사"},{"type":"span","value":"하면 됨."}]},{"type":"paragraph","children":[{"type":"span","marks":["strikethrough"],"value":"베이스와 바운드 쌍을 배열 형식으로 저장할 경우(세그멘트당 하나의 항목), 원하는 물리 주소를 얻기 위해 다음과 같은 작업을 수행"}]},{"code":"// 14 bit VA중의 상위 2 bit를 얻어옴\nSegment = (VirtualAddress & SEG_MASK) >> SEG_SHIFT\n// 이제 오프셋을 얻어옴\nOffset = VirtualAddress & OFFSET_MASK\nif (Offset >= Bounds[Segment])\n  RaiseException(PROTECTION_FAULT)\nelse\n  PhysAddr = Base[Segment] + Offset\n  Register = AccessMemory(PhysAddr)","type":"code"},{"type":"paragraph","children":[{"type":"span","value":"위의 예시를 기준으로 코드의 상수 값들을 다음과 같이 정할 수 있다."}]},{"type":"list","style":"bulleted","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","marks":["code"],"value":"SEG_MASK"},{"type":"span","value":": 0x3000"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","marks":["code"],"value":"SEG_SHIFT"},{"type":"span","value":": 12"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","marks":["code"],"value":"OFFSET_MASK"},{"type":"span","value":": 0xFFF"}]}]}]},{"type":"paragraph","children":[{"type":"span","value":"주소 공간에는 세 개의 세그멘트(코드, 힙, 스택)만 존재하기 때문에 지정 가능한 세그멘트 하나는 미사용으로 남음. ➡️ 전체 주소 공간의 1/4은 사용이 불가능"}]},{"type":"paragraph","children":[{"type":"span","value":"이 문제의 해결을 위해 "},{"type":"span","marks":["underline"],"value":"일부 시스템은 코드와 힙을 하나의 세그멘트에 저장하고 세그멘트 선택을 위해 1비트만 사용"}]},{"type":"paragraph","children":[{"type":"span","value":"특정 주소의 세그멘트를 하드웨어적으로 파악하는 다른 방법 ➡️ "},{"type":"span","marks":["highlight"],"value":"묵시적(implicit)"},{"type":"span","value":" 접근 방식"}]},{"type":"paragraph","children":[{"type":"span","value":"묵시적 접근 방식에서는 "},{"type":"span","marks":["highlight"],"value":"주소가 어떻게 형성되었나를 관찰하여 세그멘트를 결정"}]},{"type":"paragraph","children":[{"type":"span","value":"주소가 프로그램 카운터에서 생성(명령어 반입): 주소는 코드 세그멘트 내에 있을 것임."}]},{"type":"paragraph","children":[{"type":"span","value":"주소가 스택 또는 베이스에 기반을 둠: 주소는 스택 세그멘트 내에 있음."}]},{"type":"paragraph","children":[{"type":"span","value":"다른 모든 주소: 힙 세그멘트 내에 있음."}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"3️⃣ 스택"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"4️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"5️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"6️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"🧺 세그멘테이션 정리 하기"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"📚 참고 문헌"}]},{"type":"paragraph","children":[{"url":"https://pages.cs.wisc.edu/~remzi/OSTEP/vm-segmentation.pdf","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"Operating Systems: Three Easy Pieces ― 16: Segmentation"}]}]},{"type":"paragraph","children":[{"url":"https://pages.cs.wisc.edu/~remzi/OSTEP/Korean/16-vm-segmentation.pdf","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"운영체제 아주 쉬운 세 가지 이야기 ― 19: 세그멘테이션"}]}]}]}}}}},"pageContext":{"id":"177405298","locale":"ko-KR"}},"staticQueryHashes":["1034768456","1118752904","2342916782","2757196681","3415878905","3879866231","4195094990"]}