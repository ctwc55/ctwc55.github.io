{"componentChunkName":"component---src-templates-article-jsx","path":"/blog/development/os-tlb","result":{"data":{"datoCmsMiscTextString":{"locale":"ko-KR","updatedAtText":"업데이트됨","nextReadText":"관련있는 게시물"},"datoCmsBlogPost":{"locale":"ko-KR","originalId":"181878049","title":"[운영체제][OSTEP] 변환 색인 버퍼","seo":{"seoTitle":"[운영체제][OSTEP] 변환 색인 버퍼","seoDescription":"변환 색인 버퍼를 통해 주소 변환 속도를 향상시키는 방법에 대해 공부해봅니다.","seoImage":{"seoImageUrl":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format"}},"subtitle":"변환 색인 버퍼를 통해 주소 변환 속도를 향상시키는 방법에 대해 공부해봅니다.","coverImage":{"coverImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&w=860","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.25&w=860 215w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.5&w=860 430w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&w=860 860w","sizes":"(min-width: 860px) 860px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLCgoLDhMVDhcNDh0VDxUSGhYdHSIVFhUaKysjGh0oHSEWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLCgUFEBAOEC8oIhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAwAGAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAFAQQGAP/EAB0QAAEEAgMAAAAAAAAAAAAAAAEAAgMEESEFEjL/xAAWAQADAAAAAAAAAAAAAAAAAAAAAQP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDD1KM1uPLjpIRUI4GZc4aRXH25hTOHqqbth7yDIVIiXI2IQzqCoREhL/RyuQH/2Q=="},"width":860,"height":430}},"meta":{"updatedAt":"2023-08-01T15:25:09.374+09:00","firstPublishedAt":"2023-08-01T04:41:36.872+09:00"},"categoryLink":{"title":"개발 공부","id":"4743072"},"author":{"authorName":"손승열(Son Seungyeol)","picture":{"authorPictureData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77","srcSet":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.2&w=77 15w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77 30w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77 60w","sizes":"(min-width: 60px) 60px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgWEQ8LDhgYDhUNDhgNDw8NFxUdGBYfFhUaHysjGikoHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OHBANHDUcIig7NS81NS81MjUvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAFAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAABQYHAv/EAB4QAAICAgMBAQAAAAAAAAAAAAABAgMFBgQRQXEi/8QAFQEBAQAAAAAAAAAAAAAAAAAABAP/xAAaEQACAwEBAAAAAAAAAAAAAAAAAQIDEhMR/9oADAMBAAIRAxEAPwDT8/1LHSK/r67scevSfz99VXBkm/Cva/zKle/pCc/JoRXWsFujxvygcLI1pAXqQTmjONm2RzpceyCwmwxpsbbADWJdBFbeCfe2wXoAGpIL6z//2Q=="},"width":60,"height":60}}},"relatedPosts":[{"id":"181343902","meta":{"updatedAt":"2023-08-01T04:41:59.848+09:00"},"categoryLink":{"title":"개발 공부"},"coverImage":{"gatsbyImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.35&w=860","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.09&w=860 75w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.18&w=860 150w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.35&w=860 300w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&dpr=0.7&w=860 600w","sizes":"(min-width: 300px) 300px, 100vw"}},"layout":"constrained","width":300,"height":120},"squaredImage":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.24&fit=crop&fp-x=0.5&fp-y=0.5&w=430","srcSet":"https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.06&fit=crop&fp-x=0.5&fp-y=0.5&w=430 25w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.12&fit=crop&fp-x=0.5&fp-y=0.5&w=430 50w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.24&fit=crop&fp-x=0.5&fp-y=0.5&w=430 100w,\nhttps://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&auto=format&crop=focalpoint&dpr=0.47&fit=crop&fp-x=0.5&fp-y=0.5&w=430 200w","sizes":"(min-width: 100px) 100px, 100vw"}},"layout":"constrained","placeholder":{"fallback":"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBhINEBAQCggUDg0IDgcHFh0JFhEYFxUZGCIVFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OEg4REC8dFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAGAMBIgACEQEDEQH/xAAaAAEBAAIDAAAAAAAAAAAAAAAABAUGAQID/8QAHRAAAgICAwEAAAAAAAAAAAAAAAIDBAEREhQVBf/EABYBAQEBAAAAAAAAAAAAAAAAAAADAf/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/ANASs2WLoaraMl1o0O241wSYlSHjgHM9hVAEFr6bKSemzAAeclpnAAH/2Q=="},"width":100,"height":100}},"author":{"authorName":"손승열(Son Seungyeol)","picture":{"authorImageData":{"images":{"sources":[],"fallback":{"src":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77","srcSet":"https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.11&w=77 8w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.2&w=77 15w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.39&w=77 30w,\nhttps://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&dpr=0.78&w=77 60w","sizes":"(min-width: 30px) 30px, 100vw"}},"layout":"constrained","width":30,"height":30}}},"subtitle":"페이지를 사용하여 메모리를 가상화하는 방법에 대해 공부해봅니다.","title":"[운영체제][OSTEP] 페이징"}],"structuredBody":{"blocks":[],"links":[{"id":"181343902"}],"value":{"schema":"dast","document":{"type":"root","children":[{"type":"heading","level":2,"children":[{"type":"span","value":"🚪 들어가며"}]},{"type":"paragraph","children":[{"type":"span","value":"앞선 "},{"item":"181343902","type":"itemLink","children":[{"type":"span","value":"페이징"}]},{"type":"span","value":" 기법은 상당한 성능 저하를 가져올 수 있다.\n➡️ 따라서 주소 변환 속도를 향상시킬 방법을 고민해보아야 한다."}]},{"type":"paragraph","children":[{"type":"span","value":"운영체제의 실행 속도를 개선하려면 도움이 필요하다.\n➡️ 대부분의 경우 하드웨어로부터 도움을 받는다."}]},{"type":"paragraph","children":[{"type":"span","value":"주소 변환을 빠르게 하기 위해 "},{"type":"span","marks":["highlight"],"value":"변환-색인 버퍼(translation-lookaside buffer)"},{"type":"span","value":" 또는 "},{"type":"span","marks":["highlight"],"value":"TLB"},{"type":"span","value":"라는 것을 도입한다."}]},{"type":"paragraph","children":[{"type":"span","value":"TLB는 칩의 "},{"type":"span","marks":["highlight"],"value":"메모리 관리부(memory-management unit, MMU)"},{"type":"span","value":"의 일부다."}]},{"type":"paragraph","children":[{"type":"span","value":"TLB는 자주 참조되는 가상 주소-실주소 변환 정보를 저장하는 하드웨어 캐시로, "},{"type":"span","marks":["highlight"],"value":"주소-변환 캐시(address-translation cache)"},{"type":"span","value":"라고도 불린다."}]},{"type":"paragraph","children":[{"type":"span","value":"하드웨어는 먼저 TLB에 원하는 변환 정보가 있는지 확인한다.\n➡️ 있는 경우 페이지 테이블을 통하지 않고 변환을 빠르게 수행한다."}]},{"type":"paragraph","children":[{"type":"span","value":"실질적으로 "},{"type":"span","marks":["highlight"],"value":"TLB는 페이징 성능을 엄청나게 향상"},{"type":"span","value":"시킨다.\n➡️ TLB를 도입함으로써, 페이징이 \"사용 가능\"한 가상 메모리 기법이 된다."}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"1️⃣ TLB의 기본 알고리즘"}]},{"type":"paragraph","children":[{"type":"span","value":"아래의 코드는 가상 주소 변환이 이루어지는 과정을 대략적으로 나타내고 있다."}]},{"code":"VPN = (VirtualAddress & VPN_MASK) >> SHIFT\n(Success, TlbEntry) = TLB_Lookup(VPN)\nif (Success == True) // TLB ⯩✙\n  if (CanAccess(TlbEntry.ProtectBits) == True)\n    Offset = VirtualAddress & OFFSET_MASK\n    PhysAddr = (TlbEntry.PFN << SHIFT) | Offset\n    AccessMemory(PhysAddr)\n  else\n    RaiseException(PROTECTION_FAULT)\nelse // TLB 미스\n  PTEAddr = PTBR + (VPN * sizeof(PTE))\n  PTE = AccessMemory(PTEAddr)\n  if (PTE.Valid == False)\n    RaiseException(SEGMENTATION_FAULT)\n  else if (CanAccess(PTE.ProtectBits) == False)\n    RaiseException(PROTECTION_FAULT)\n  else\n    TLB_Insert(VPN, PTE.PFN, PTE.ProtectBits)\n    RetryInstruction()","type":"code","language":"c"},{"type":"paragraph","children":[{"type":"span","value":"위의 예시에서는 주소 변환부가 단순한 "},{"type":"span","marks":["highlight"],"value":"선형 페이지 테이블(linear page table)"},{"type":"span","value":"과 "},{"type":"span","marks":["highlight"],"value":"하드웨어로 관리되는 TLB"},{"type":"span","value":"(하드웨어가 페이지 테이블 접근에 대한 대부분의 책임을 관리)로 구성되어 있다."}]},{"type":"paragraph","children":[{"type":"span","value":"하드웨어 부분의 알고리즘의 동작은 다음과 같다."}]},{"type":"list","style":"numbered","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"가상 주소("},{"type":"span","marks":["underline"],"value":"line 1"},{"type":"span","value":")에서 VPN 추출"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"해당 VPN의 TLB 존재 여부를 검사("},{"type":"span","marks":["underline"],"value":"line 2"},{"type":"span","value":")"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"만약 존재하면 "},{"type":"span","marks":["highlight"],"value":"TLB 히트"},{"type":"span","value":" = TLB가 변환 값을 갖고 있음.("},{"type":"span","marks":["underline"],"value":"line 3"},{"type":"span","value":")"}]},{"type":"list","style":"numbered","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"해당 TLB 항목에서 PFN를 추출할 수 있음."}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"해당 페이지에 대한 접근 권한 검사가 성공 시("},{"type":"span","marks":["underline"],"value":"line 4"},{"type":"span","value":")"}]},{"type":"list","style":"numbered","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"원래 가상 주소의 오프셋과 합쳐서 원하는 물리 주소(PA) 구성("},{"type":"span","marks":["underline"],"value":"line 5-6"},{"type":"span","value":")"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"✅ 메모리에 접근("},{"type":"span","marks":["underline"],"value":"line 7"},{"type":"span","value":")"}]}]}]}]}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"만약 존재하지 않으면 "},{"type":"span","marks":["highlight"],"value":"TLB 미스"},{"type":"span","value":" = TLB에 변환 정보 존재X("},{"type":"span","marks":["underline"],"value":"line 10"},{"type":"span","value":")"}]},{"type":"list","style":"numbered","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"하드웨어가 변환 정보를 찾기 위해 페이지 테이블에 접근("},{"type":"span","marks":["underline"],"value":"line 11-12"},{"type":"span","value":")"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"프로세스가 생성한 가상 메모리 참조가 유효하고 접근 가능 시("},{"type":"span","marks":["underline"],"value":"line 17"},{"type":"span","value":")"}]},{"type":"list","style":"numbered","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"✅ 해당 변환 정보를 TLB로 읽어들임.("},{"type":"span","marks":["underline"],"value":"line 18"},{"type":"span","value":")"}]},{"type":"paragraph","children":[{"type":"span","value":"➡️ ⚠️ 매우 시간이 많이 소요되는 작업"}]}]}]}]}]}]}]},{"type":"paragraph","children":[{"type":"span","value":"위에서 매우 시간이 많이 소요되게 되는 경우 그 이유는 "},{"type":"span","marks":["underline"],"value":"페이지 테이블 접근을 위한 메모리 참조 때문"},{"type":"span","value":"임.("},{"type":"span","marks":["underline"],"value":"line 12"},{"type":"span","value":")"}]},{"type":"paragraph","children":[{"type":"span","value":"TLB가 갱신되면 하드웨어는 명령어를 재실행한다.("},{"type":"span","marks":["underline"],"value":"line 19"},{"type":"span","value":")\n➡️ TLB에 변환 정보가 존재하므로 메모리 참조가 빠르게 처리됨."}]},{"type":"paragraph","children":[{"type":"span","value":"💡 TLB 설계 철학\n\"주소 변환 정보가 대부분의 경우 캐시에 있다\"(즉, 캐시에서 히트)라는 가정을 전제"}]},{"type":"paragraph","children":[{"type":"span","value":"TLB는 "},{"type":"span","marks":["highlight"],"value":"프로세싱 코어와 가까운 곳에 위치"},{"type":"span","value":" & "},{"type":"span","marks":["highlight"],"value":"매우 빠른 하드웨어로 구성"},{"type":"span","value":"\n➡️ 주소 변환 작업은 그다지 부담스러운 작업X\n➡️ ⚠️ "},{"type":"span","marks":["highlight"],"value":"미스가 발생하는 경우, 페이징 비용이 커짐."}]},{"type":"paragraph","children":[{"type":"span","value":"메모리 접근 연산은 다른 CPU연산에 비해 매우 시간이 오래 걸림.\n➡️ TLB 미스가 발생하는 경우를 최대한 피해야 함."}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"2️⃣ 예제: 배열 접근"}]},{"type":"paragraph","children":[{"type":"span","value":"간단한 가상 주소 트레이스 예시를 통해 TLB로 인한 성능 개선을 알아보자."}]},{"type":"paragraph","children":[{"type":"span","value":"이 예시에서는 가상 주소 100번지부터 10개의 4바이트 크기의 정수 배열이 존재한다고 가정하자."}]},{"type":"paragraph","children":[{"type":"span","value":"가상 주소 공간은 8비트이며, 페이지 크기는 16바이트이다."}]},{"type":"paragraph","children":[{"type":"span","value":"가상 주소는 4비트 VPN(16개의 가상 페이지 표현)과 4비트 오프셋(각 페이지는 16바이트 크기를 가짐)으로 구성된다."}]},{"type":"paragraph","children":[{"type":"span","value":"아래는 이러한 16개의 페이지로 구성된 가상 주소 공간을 나타내고 있다."}]},{"code":"                    Offset\n        00     04     08     12     16\n         ┌───────────────────────────┐\nVPN = 00 │                           │ \n         ├───────────────────────────┤\nVPN = 01 │                           │ \n         ├───────────────────────────┤\nVPN = 02 │                           │ \n         ├───────────────────────────┤\nVPN = 03 │                           │ \n         ├───────────────────────────┤\nVPN = 04 │                           │ \n         ├───────────────────────────┤\nVPN = 05 │                           │ \n         ├──────┬──────┬──────┬──────┤\nVPN = 06 │      │ a[0] │ a[1] │ a[2] │ \n         ├──────┼──────┼──────┼──────┤\nVPN = 07 │ a[3] │ a[4] │ a[5] │ a[6] │ \n         ├──────┼──────┼──────┼──────┤\nVPN = 08 │ a[7] │ a[8] │ a[9] │      │ \n         ├──────┴──────┴──────┴──────┤\nVPN = 09 │                           │ \n         ├───────────────────────────┤\nVPN = 10 │                           │ \n         ├───────────────────────────┤\nVPN = 11 │                           │ \n         ├───────────────────────────┤\nVPN = 12 │                           │ \n         ├───────────────────────────┤\nVPN = 13 │                           │ \n         ├───────────────────────────┤\nVPN = 14 │                           │ \n         ├───────────────────────────┤\nVPN = 15 │                           │ \n         └───────────────────────────┘","type":"code"},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"3️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"4️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"5️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"6️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"7️⃣"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"🧺 변환 색인 버퍼 정리 하기"}]},{"type":"paragraph","children":[{"type":"span","value":""}]},{"type":"thematicBreak"},{"type":"heading","level":2,"children":[{"type":"span","value":"📚 참고 문헌"}]},{"type":"paragraph","children":[{"url":"https://pages.cs.wisc.edu/~remzi/OSTEP/vm-tlbs.pdf","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"Operating Systems: Three Easy Pieces ― 19: Paging: Faster Translations (TLBs)"}]}]},{"type":"paragraph","children":[{"url":"https://pages.cs.wisc.edu/~remzi/OSTEP/Korean/19_vm-tlbs.pdf","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"운영체제 아주 쉬운 세 가지 이야기 ― 22: 페이징: 더 빠른 변환 (TLB)"}]}]}]}}}}},"pageContext":{"id":"181878049","locale":"ko-KR"}},"staticQueryHashes":["1034768456","1118752904","2342916782","2757196681","3415878905","3879866231","4195094990"]}