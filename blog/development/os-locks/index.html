<!DOCTYPE html><html lang="ko-KR" dir="ltr" class="lightTheme"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta data-react-helmet="true" name="theme-color" content="#0067fa"/><meta data-react-helmet="true" name="description" content="임계 영역에서의 원자적인 실행을 위한 락에 대해 공부해봅니다."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="[운영체제][OSTEP] 락 — CTWC 블로그"/><meta data-react-helmet="true" property="twitter:title" content="[운영체제][OSTEP] 락 — CTWC 블로그"/><meta data-react-helmet="true" property="og:description" content="임계 영역에서의 원자적인 실행을 위한 락에 대해 공부해봅니다."/><meta data-react-helmet="true" property="twitter:description" content="임계 영역에서의 원자적인 실행을 위한 락에 대해 공부해봅니다."/><meta data-react-helmet="true" property="og:image" content="https://www.datocms-assets.com/66479/1686985811-og4.png?auto=format"/><meta data-react-helmet="true" property="twitter:image" content="https://www.datocms-assets.com/66479/1686985811-og4.png?auto=format"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="twitter:url"/><style data-styled="" data-styled-version="5.3.11">@import url('https://webfontworld.github.io/NanumSquareNeo/NanumSquareNeo.css');/*!sc*/
:root{--globalContainer:1100px;--articleContainer:700px;--globalPaddingLr:30px;--globalPaddingTb:60px;--defaultRadius:10px;--gapSmall:10px;--gapRegular:20px;--gapL:30px;--gapXL:60px;--borderRegular:2px;--borderSmall:1px;--defaultStack:"NanumSquareNeo",-apple-system,BlinkMacSystemFont,"Helvetica","Helvetica Neue","Arial",sans-serif;--defaultCodeStack:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;--headingXXL:3.25rem;--headingXL:2.625rem;--headingL:2rem;--headingM:1.625rem;--headingS:1.375rem;--baseXL:1.25rem;--baseL:1.125rem;--baseM:1rem;--baseS:.815rem;--baseMMobile:calc(var(--baseM) * 1.05);--baseSMobile:calc(var(--baseS) * 1.1);--headingsLineHeight:1.1;--bodyLineHeight:1.5;}/*!sc*/
*,*::before,*::after{box-sizing:border-box;}/*!sc*/
html{font-size:100%;font-family:var(--defaultStack);margin:0;padding:0;line-height:var(--bodyLineHeight);background:var(--backgroundColor);}/*!sc*/
[dir=rtl]{font-size:110%;}/*!sc*/
.lightTheme{--primaryColor:#0067FA;--headingsColor:#4D4D4D;--baseTextColor:#3F3844;--dividerColor:#E2E2E2;--markBackgroundColor:#FBEC77;--markTextColor:#4D4D4D;--inlineCodeTextColor:#4D4D4D;--inlineCodeBackgroundColor:#DBEFFF;--backgroundColor:#FFFFFF;--backgroundTransparentColor:rgba(255,255,255,0);--backgroundColorAlt:#FFFFFF;--codeBlockBackgroundColor:#181B22;}/*!sc*/
.darkTheme{--primaryColor:#5995EA;--headingsColor:#EEEEEE;--baseTextColor:#AAAAAA;--dividerColor:#242A31;--markBackgroundColor:#B2DBFF;--markTextColor:#181B22;--inlineCodeTextColor:#FFFFFF;--inlineCodeBackgroundColor:#293B4A;--backgroundColor:#181B22;--backgroundTransparentColor:rgba(24,27,34,0);--backgroundColorAlt:#1D2028;--codeBlockBackgroundColor:#181B22;}/*!sc*/
body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-weight:500;color:var(--baseTextColor);margin:0;padding:0;}/*!sc*/
h1,h2,h3,p{margin:0;padding:0;}/*!sc*/
ul,ol{list-style-type:none;margin:0;padding:0;}/*!sc*/
button{cursor:pointer;margin:0;padding:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;background:none;}/*!sc*/
button,input,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;background-color:transparent;}/*!sc*/
b,strong{font-weight:700;}/*!sc*/
address,time{font-style:normal;}/*!sc*/
.activeClassLink{color:var(--primaryColor) !important;cursor:default;}/*!sc*/
.classicButton{background:var(--primaryColor);color:white;-webkit-transition:background 300ms ease-out;transition:background 300ms ease-out;border-radius:10px;white-space:nowrap;font-weight:700;font-family:var(--defaultStack);font-size:var(--baseM);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:-webkit-min-content;width:-moz-min-content;width:min-content;height:-webkit-min-content;height:-moz-min-content;height:min-content;padding:.6em 1em;}/*!sc*/
.classicButton:hover{background:var(--primaryDark);}/*!sc*/
@media screen and (max-width:768px){.classicButton{font-size:var(--baseMMobile);}}/*!sc*/
.classicButtonOutline{border:var(--borderRegular) solid var(--primaryColor);background:transparent;color:var(--primaryColor);padding:.4em 1em;-webkit-transition:background 300ms ease-out,color 300ms ease-out;transition:background 300ms ease-out,color 300ms ease-out;}/*!sc*/
.classicButtonOutline:hover{background:var(--primaryColor);color:white;}/*!sc*/
data-styled.g1[id="sc-global-eipMVz1"]{content:"sc-global-eipMVz1,"}/*!sc*/
.ixJjbe{display:grid;}/*!sc*/
data-styled.g2[id="sc-1cpn2c5-0"]{content:"ixJjbe,"}/*!sc*/
.gzssFe{display:grid;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-auto-flow:column;-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);}/*!sc*/
@media screen and (max-width:767px){.gzssFe{-webkit-column-gap:0;column-gap:0;}}/*!sc*/
data-styled.g3[id="sc-1cpn2c5-1"]{content:"gzssFe,"}/*!sc*/
.fnugyN span{cursor:not-allowed;color:var(--primaryColor);}/*!sc*/
data-styled.g4[id="sc-1cpn2c5-2"]{content:"fnugyN,"}/*!sc*/
.geuSbO{font-weight:600;color:var(--baseTextColor);-webkit-transition:color 0.2s linear;transition:color 0.2s linear;text-transform:uppercase;color:var(--primaryColor);}/*!sc*/
@media (hover:hover){.geuSbO:hover{color:var(--primaryColor);}}/*!sc*/
@media screen and (max-width:767px){.geuSbO{padding:var(--gapSmall);}}/*!sc*/
@media (hover:hover){.geuSbO:hover{color:var(--primaryColor);}}/*!sc*/
.khIuEb{font-weight:600;color:var(--baseTextColor);-webkit-transition:color 0.2s linear;transition:color 0.2s linear;text-transform:uppercase;}/*!sc*/
@media (hover:hover){.khIuEb:hover{color:var(--primaryColor);}}/*!sc*/
@media screen and (max-width:767px){.khIuEb{padding:var(--gapSmall);}}/*!sc*/
data-styled.g5[id="sc-1cpn2c5-3"]{content:"geuSbO,khIuEb,"}/*!sc*/
.dTDcKG{padding:0.33em;display:grid;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;width:40px;height:40px;--rowHeight:4px;grid-template-rows:repeat(3,var(--rowHeight));row-gap:var(--rowHeight);}/*!sc*/
data-styled.g6[id="sc-44p2kd-0"]{content:"dTDcKG,"}/*!sc*/
.drgnVa{border-radius:var(--rowHeight);-webkit-transition:all 300ms ease-out;transition:all 300ms ease-out;height:var(--rowHeight);width:100%;background:var(--baseTextColor);}/*!sc*/
data-styled.g7[id="sc-44p2kd-1"]{content:"drgnVa,"}/*!sc*/
.eigRi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media screen and (max-width:860px){.eigRi{display:none;}}/*!sc*/
.epnDCc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g8[id="sc-r8riu4-0"]{content:"eigRi,epnDCc,"}/*!sc*/
.dCTwrf{display:none;}/*!sc*/
@media screen and (max-width:768px){.dCTwrf{display:block;}}/*!sc*/
data-styled.g9[id="sc-10pcvyt-0"]{content:"dCTwrf,"}/*!sc*/
.fnzgpr{width:280px;border-radius:var(--defaultRadius);border:var(--borderRegular) solid var(--primaryColor);position:absolute;top:calc(var(--globalPaddingLr) * 3);background:var(--backgroundColorAlt);padding:var(--gapSmall) 0;-webkit-transition:opacity 300ms ease-out;transition:opacity 300ms ease-out;z-index:5;right:var(--globalPaddingLr);display:none;}/*!sc*/
@media screen and (max-width:480px){.fnzgpr{max-width:calc(100vw - calc(var(--globalPaddingLr) * 2));}}/*!sc*/
data-styled.g10[id="sc-10pcvyt-1"]{content:"fnzgpr,"}/*!sc*/
.iACCRi{display:grid;justify-items:center;}/*!sc*/
data-styled.g11[id="sc-10pcvyt-2"]{content:"iACCRi,"}/*!sc*/
.vehsg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
data-styled.g12[id="sc-10pcvyt-3"]{content:"vehsg,"}/*!sc*/
.czjcBe{padding:var(--gapSmall) var(--gapRegular);width:100%;display:grid;justify-items:end;}/*!sc*/
data-styled.g13[id="sc-10pcvyt-4"]{content:"czjcBe,"}/*!sc*/
.rXwHW{padding:var(--gapSmall) var(--gapRegular);width:100%;color:var(--headingsColor);font-size:var(--baseL);text-align:inherit;line-height:var(--bodyLineHeight);font-weight:600;font-size:var(--baseL);}/*!sc*/
data-styled.g14[id="sc-10pcvyt-5"]{content:"rXwHW,"}/*!sc*/
.ePYRgY{padding:var(--gapSmall) var(--gapRegular);width:100%;color:var(--headingsColor);font-size:var(--baseL);text-align:inherit;line-height:var(--bodyLineHeight);font-weight:600;font-size:var(--baseL);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:color 300ms ease-out;transition:color 300ms ease-out;color:var(--headingsColor);}/*!sc*/
data-styled.g15[id="sc-10pcvyt-6"]{content:"ePYRgY,"}/*!sc*/
.fNkHNw{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g16[id="sc-10pcvyt-7"]{content:"fNkHNw,"}/*!sc*/
.ggXheO{padding:var(--gapSmall) var(--gapRegular);width:100%;color:var(--headingsColor);font-size:var(--baseL);text-align:inherit;line-height:var(--bodyLineHeight);font-size:var(--baseM);font-weight:600;}/*!sc*/
data-styled.g17[id="sc-10pcvyt-8"]{content:"ggXheO,"}/*!sc*/
.jvfMuW{height:var(--borderSmall);background:var(--dividerColor);width:calc(100% - calc(var(--gapRegular) * 2));position:relative;left:var(--gapRegular);}/*!sc*/
data-styled.g18[id="sc-10pcvyt-9"]{content:"jvfMuW,"}/*!sc*/
.dRxvTw{font-size:var(--headingS);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-height:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:-webkit-transform 300ms ease-out,color 300ms ease-out;-webkit-transition:transform 300ms ease-out,color 300ms ease-out;transition:transform 300ms ease-out,color 300ms ease-out;-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);}/*!sc*/
data-styled.g19[id="sc-10pcvyt-10"]{content:"dRxvTw,"}/*!sc*/
.dEebeF{color:var(--primaryColor);font-size:var(--baseSMobile);padding:var(--gapRegular);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g20[id="sc-10pcvyt-11"]{content:"dEebeF,"}/*!sc*/
.gjrpoj{visibility:hidden;position:absolute;-webkit-transition:height 300ms ease-out;transition:height 300ms ease-out;overflow:hidden;}/*!sc*/
data-styled.g21[id="sc-10pcvyt-12"]{content:"gjrpoj,"}/*!sc*/
.ieCpoN{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;padding:var(--globalPaddingLr) var(--globalPaddingLr) var(--globalPaddingTb);}/*!sc*/
@media screen and (max-width:860px){.ieCpoN{-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}/*!sc*/
.dVgTdY{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;padding:var(--globalPaddingTb) var(--globalPaddingLr);}/*!sc*/
@media screen and (max-width:860px){.dVgTdY{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}/*!sc*/
data-styled.g22[id="sc-1fa65t8-0"]{content:"ieCpoN,dVgTdY,"}/*!sc*/
.cZKuCp{display:grid;grid-template-columns:1fr 1fr;-webkit-column-gap:var(--gapXL);column-gap:var(--gapXL);row-gap:var(--gapXL);max-width:var(--articleContainer);width:100%;}/*!sc*/
@media screen and (max-width:760px){.cZKuCp{-webkit-column-gap:var(--gapL);column-gap:var(--gapL);}}/*!sc*/
@media screen and (max-width:620px){.cZKuCp{grid-template-columns:1fr;}}/*!sc*/
data-styled.g24[id="sc-1fa65t8-2"]{content:"cZKuCp,"}/*!sc*/
.cawStE{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:var(--gapXL);width:100%;max-width:var(--articleContainer);}/*!sc*/
.cawStE a:last-child{-webkit-align-items:right;-webkit-box-align:right;-ms-flex-align:right;align-items:right;}/*!sc*/
@media screen and (max-width:350px){.cawStE a:last-child{display:none;}}/*!sc*/
data-styled.g27[id="sc-1fa65t8-5"]{content:"cawStE,"}/*!sc*/
.ieohLm{width:var(--globalContainer);bottom:0;position:absolute;height:var(--borderSmall);margin:0;border:var(--borderSmall) none;background:var(--dividerColor);}/*!sc*/
@media screen and (max-width:1160px){.ieohLm{left:var(--globalPaddingLr);width:calc(100% - calc(var(--globalPaddingLr) * 2));}}/*!sc*/
.ieohKG{width:var(--globalContainer);top:0;position:absolute;height:var(--borderSmall);margin:0;border:var(--borderSmall) none;background:var(--dividerColor);}/*!sc*/
@media screen and (max-width:1160px){.ieohKG{left:var(--globalPaddingLr);width:calc(100% - calc(var(--globalPaddingLr) * 2));}}/*!sc*/
data-styled.g30[id="sc-1fa65t8-8"]{content:"ieohLm,ieohKG,"}/*!sc*/
.dbHbus{white-space:nowrap;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g31[id="sc-4aeesa-0"]{content:"dbHbus,"}/*!sc*/
.gavkVi{cursor:pointer;border:none;background:none;font-weight:600;display:grid;-webkit-column-gap:var(--gapSmall);column-gap:var(--gapSmall);grid-template-columns:min-content auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:color 300ms ease-out;transition:color 300ms ease-out;color:var(--headingsColor);}/*!sc*/
data-styled.g32[id="sc-4aeesa-1"]{content:"gavkVi,"}/*!sc*/
.ibbwvZ{font-size:var(--baseXL);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-height:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:-webkit-transform 300ms ease-out,color 300ms ease-out;-webkit-transition:transform 300ms ease-out,color 300ms ease-out;transition:transform 300ms ease-out,color 300ms ease-out;-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);}/*!sc*/
data-styled.g33[id="sc-4aeesa-2"]{content:"ibbwvZ,"}/*!sc*/
.cDqTDt{position:absolute;top:2.5em;z-index:2;right:0;min-width:220px;display:grid;grid-auto-flow:row;padding:var(--gapSmall) 0;background:var(--backgroundColorAlt);border-radius:20px;border:var(--borderRegular) solid var(--dividerColor);height:auto;display:none;}/*!sc*/
data-styled.g34[id="sc-4aeesa-3"]{content:"cDqTDt,"}/*!sc*/
.hZEFWV{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;}/*!sc*/
data-styled.g35[id="sc-4aeesa-4"]{content:"hZEFWV,"}/*!sc*/
.iRHJDZ{padding:var(--gapSmall) var(--gapRegular);width:100%;}/*!sc*/
data-styled.g36[id="sc-4aeesa-5"]{content:"iRHJDZ,"}/*!sc*/
.gylzxj{margin-top:var(--gapSmall);color:var(--primaryColor) !important;font-size:var(--baseS);padding:var(--gapSmall) var(--gapRegular);}/*!sc*/
@media (hover:hover){.gylzxj:hover{-webkit-text-decoration:underline;text-decoration:underline;}}/*!sc*/
data-styled.g37[id="sc-4aeesa-6"]{content:"gylzxj,"}/*!sc*/
.dddcZz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:var(--globalPaddingLr);width:100%;position:relative;}/*!sc*/
data-styled.g38[id="sc-ocb3rv-0"]{content:"dddcZz,"}/*!sc*/
.SZAri{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:var(--globalContainer);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g39[id="sc-ocb3rv-1"]{content:"SZAri,"}/*!sc*/
@media screen and (max-width:768px){.lgzEwb{display:none;}}/*!sc*/
data-styled.g40[id="sc-ocb3rv-2"]{content:"lgzEwb,"}/*!sc*/
.eMWcoN{display:grid;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-auto-flow:column;-webkit-column-gap:var(--gapXL);column-gap:var(--gapXL);}/*!sc*/
.eMWcoN li a{color:var(--headingsColor);-webkit-transition:color 0.1s linear;transition:color 0.1s linear;font-weight:600;}/*!sc*/
.eMWcoN li a:hover{color:var(--primaryColor);}/*!sc*/
@media screen and (max-width:860px){.eMWcoN{-webkit-column-gap:var(--gapL);column-gap:var(--gapL);}}/*!sc*/
data-styled.g41[id="sc-ocb3rv-3"]{content:"eMWcoN,"}/*!sc*/
.hpyiIq{display:grid;grid-auto-flow:column;-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);}/*!sc*/
@media screen and (max-width:768px){.hpyiIq{grid-template-columns:auto auto auto;}}/*!sc*/
data-styled.g42[id="sc-ocb3rv-4"]{content:"hpyiIq,"}/*!sc*/
.kWpURc{height:100%;width:var(--borderSmall);background:var(--dividerColor);display:block;}/*!sc*/
@media screen and (max-width:768px){.kWpURc{display:none;}}/*!sc*/
.oCqE{height:100%;width:var(--borderSmall);background:var(--dividerColor);display:none;}/*!sc*/
@media screen and (max-width:768px){.oCqE{display:block;}}/*!sc*/
data-styled.g43[id="sc-ocb3rv-5"]{content:"kWpURc,oCqE,"}/*!sc*/
.lfShgD{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:var(--globalContainer);-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;max-width:var(--globalContainer);}/*!sc*/
@media screen and (max-width:950px){.lfShgD{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--gapSmall);}}/*!sc*/
data-styled.g44[id="sc-14wwzx0-0"]{content:"lfShgD,"}/*!sc*/
.imCxOf{font-size:var(--baseS);text-align:start;}/*!sc*/
.imCxOf a{color:var(--primaryColor);}/*!sc*/
@media (hover:hover){.imCxOf a{-webkit-text-decoration:underline;text-decoration:underline;}}/*!sc*/
data-styled.g45[id="sc-14wwzx0-1"]{content:"imCxOf,"}/*!sc*/
.gEkEYr{font-size:var(--baseS);text-align:end;}/*!sc*/
.gEkEYr a{color:var(--primaryColor);}/*!sc*/
@media (hover:hover){.gEkEYr a{-webkit-text-decoration:underline;text-decoration:underline;}}/*!sc*/
data-styled.g46[id="sc-14wwzx0-2"]{content:"gEkEYr,"}/*!sc*/
.kTTpgy{font-size:var(--headingXXL);color:var(--headingsColor);text-align:inherit;line-height:var(--headingsLineHeight);}/*!sc*/
@media screen and (max-width:768px){.kTTpgy{font-size:var(--headingXL);}}/*!sc*/
data-styled.g48[id="sc-xcp2je-1"]{content:"kTTpgy,"}/*!sc*/
.gOHTsl{font-size:var(--baseXL);color:var(--baseTextColor);text-align:inherit;line-height:var(--bodyLineHeight);}/*!sc*/
data-styled.g49[id="sc-xcp2je-2"]{content:"gOHTsl,"}/*!sc*/
.dzBDzs.dzBDzs.dzBDzs{font-size:var(--headingXL);text-align:center;}/*!sc*/
@media screen and (max-width:860px){.dzBDzs.dzBDzs.dzBDzs{text-align:inherit;}}/*!sc*/
@media screen and (max-width:768px){.dzBDzs.dzBDzs.dzBDzs{font-size:var(--headingL);}}/*!sc*/
data-styled.g50[id="sc-xcp2je-3"]{content:"dzBDzs,"}/*!sc*/
.kHLwub.kHLwub.kHLwub{text-align:center;}/*!sc*/
@media screen and (max-width:860px){.kHLwub.kHLwub.kHLwub{text-align:inherit;}}/*!sc*/
data-styled.g51[id="sc-xcp2je-4"]{content:"kHLwub,"}/*!sc*/
.iAerpu.iAerpu.iAerpu{font-size:var(--headingL);}/*!sc*/
@media screen and (max-width:768px){.iAerpu.iAerpu.iAerpu{font-size:calc(var(--headingL) * 0.8);}}/*!sc*/
data-styled.g52[id="sc-xcp2je-5"]{content:"iAerpu,"}/*!sc*/
.kWxtIT{font-size:var(--baseL);color:var(--headingsColor);text-align:inherit;font-weight:700;line-height:1.2;}/*!sc*/
@media screen and (max-width:768px){.kWxtIT{font-size:var(--baseXL);}}/*!sc*/
data-styled.g54[id="sc-xcp2je-7"]{content:"kWxtIT,"}/*!sc*/
.dYCkih{--paragraphBottomMargin:1.6em;--paragraphMargin:0 0 var(--paragraphBottomMargin) 0;--headingsMargin:0 0 0.8em 0;--listMargin:0 0 0.33em 0;width:var(--articleContainer);}/*!sc*/
.dYCkih ol{list-style-type:decimal;margin:var(--paragraphMargin);line-height:1.6;}/*!sc*/
.dYCkih ol li > ol{list-style-type:lower-roman;margin:var(--listMargin);}/*!sc*/
.dYCkih ol li p{margin:0;}/*!sc*/
.dYCkih ol li::marker{color:var(--baseTextColor);font-size:var(--baseL);}/*!sc*/
.dYCkih ul{list-style-type:disc;margin:var(--paragraphMargin);line-height:1.6;}/*!sc*/
.dYCkih ul li > ul{margin:var(--listMargin);}/*!sc*/
.dYCkih ul li p{margin:0;}/*!sc*/
.dYCkih ul li::marker{color:var(--baseTextColor);font-size:var(--baseM);}/*!sc*/
.dYCkih a{color:LightSlateGrey;-webkit-text-decoration:none;text-decoration:none;padding-bottom:1px;background:linear-gradient( to right,rgba(100,200,200,1),rgba(100,200,200,1) ),linear-gradient( to right,rgba(255,0,0,1),rgba(255,0,180,1),rgba(0,100,200,1) );background-size:100% 3px,0 3px;background-position:100% 100%,0 100%;background-repeat:no-repeat;-webkit-transition:background-size 400ms;transition:background-size 400ms;}/*!sc*/
.dYCkih a > code{background:var(--inlineCodeBackgroundColor);padding:0.1em 0.2em;border-radius:5px;}/*!sc*/
.dYCkih a:hover{background-size:0 3px,100% 3px;}/*!sc*/
.dYCkih p > code{background:var(--inlineCodeBackgroundColor);color:var(--inlineCodeTextColor);padding:0.1em 0.2em;border-radius:5px;}/*!sc*/
.dYCkih pre{padding:var(--globalPaddingLr) !important;border-radius:var(--defaultRadius) !important;margin:var(--paragraphMargin) !important;background:var(--codeBlockBackgroundColor) none repeat scroll 0% 0% !important;border:var(--borderSmall) solid var(--dividerColor) !important;}/*!sc*/
@media screen and (max-width:800px){.dYCkih pre{border-radius:0 !important;margin:var(--paragraphBottomMargin) calc(var(--globalPaddingLr) * -1) !important;}}/*!sc*/
.dYCkih pre code{font-family:var(--defaultCodeStack) !important;}/*!sc*/
.dYCkih mark{background:var(--markBackgroundColor);color:var(--markTextColor);}/*!sc*/
.dYCkih ol,.dYCkih ul{padding-left:1.33em;}/*!sc*/
.dYCkih p{color:var(--baseTextColor);font-size:var(--baseL);margin:var(--paragraphMargin);}/*!sc*/
.dYCkih p:only-child,.dYCkih p:last-child{margin:0;}/*!sc*/
.dYCkih p + h2,.dYCkih p + h3{margin:2em 0 0.8em 0;}/*!sc*/
.dYCkih h2,.dYCkih h3{line-height:var(--headingsLineHeight);color:var(--headingsColor);margin:var(--headingsMargin);}/*!sc*/
.dYCkih h2{font-size:var(--headingM);}/*!sc*/
@media screen and (max-width:768px){.dYCkih h2{font-size:var(--headingS);}}/*!sc*/
.dYCkih h3{font-size:var(--headingS);}/*!sc*/
@media screen and (max-width:768px){.dYCkih h3{font-size:var(--baseL);}}/*!sc*/
.dYCkih hr{margin:calc(var(--paragraphBottomMargin) * 2) 0;color:var(--dividerColor);background-color:var(--dividerColor);border:none;height:var(--borderSmall);}/*!sc*/
@media screen and (max-width:860px){.dYCkih{width:100%;}}/*!sc*/
data-styled.g61[id="sc-1tn1m5t-1"]{content:"dYCkih,"}/*!sc*/
.bEOXNU{position:absolute;width:-webkit-min-content;width:-moz-min-content;width:min-content;padding:0 0.4em;background:var(--primaryColor);border-radius:calc(var(--defaultRadius) / 2);position:absolute;text-transform:uppercase;font-size:var(--baseS);color:white;right:calc(var(--defaultRadius) / 2);top:calc(var(--defaultRadius) / 2);}/*!sc*/
@media screen and (max-width:800px){.bEOXNU{left:0 !important;top:calc(calc(var(--baseS) / 1.5) * -1) !important;right:unset !important;border-radius:calc(var(--defaultRadius) / 2) 0;}}/*!sc*/
data-styled.g62[id="sc-1tn1m5t-2"]{content:"bEOXNU,"}/*!sc*/
.bbUTbE{width:100%;row-gap:var(--gapSmall);display:grid;height:-webkit-min-content;height:-moz-min-content;height:min-content;-webkit-box-pack:start;-webkit-justify-content:start;-ms-flex-pack:start;justify-content:start;}/*!sc*/
@media screen and (max-width:950px){.bbUTbE{grid-template-columns:repeat(3,1fr);-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);-webkit-align-items:initial;-webkit-box-align:initial;-ms-flex-align:initial;align-items:initial;min-height:120px;}}/*!sc*/
@media (hover:hover){.bbUTbE:hover h1{color:var(--primaryColor);}}/*!sc*/
data-styled.g63[id="sc-xqrh7l-0"]{content:"bbUTbE,"}/*!sc*/
.bWoXQo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g64[id="sc-xqrh7l-1"]{content:"bWoXQo,"}/*!sc*/
.jWsskh{border-radius:var(--defaultRadius);z-index:2;}/*!sc*/
@media screen and (max-width:950px){.jWsskh{--widthMobile:50px;min-width:var(--widthMobile);min-height:var(--widthMobile);}}/*!sc*/
.jWsskh picture img{border-radius:var(--defaultRadius);}/*!sc*/
@media screen and (max-width:950px){.jWsskh picture img{height:unset !important;}}/*!sc*/
data-styled.g65[id="sc-xqrh7l-2"]{content:"jWsskh,"}/*!sc*/
.cetJnl{width:-webkit-max-content;width:-moz-max-content;width:max-content;white-space:nowrap;line-height:0.8;position:relative;padding:0.3em 0.5em 0.4em 0.5em;margin-bottom:-5px;border:var(--borderSmall) solid var(--primaryColor);color:var(--primaryColor);border-radius:5px;font-size:var(--baseS);font-weight:600;}/*!sc*/
@media screen and (max-width:950px){.cetJnl{margin-bottom:0;}}/*!sc*/
data-styled.g66[id="sc-xqrh7l-3"]{content:"cetJnl,"}/*!sc*/
.btBOV{row-gap:var(--gapSmall);display:grid;height:-webkit-max-content;height:-moz-max-content;height:max-content;}/*!sc*/
@media screen and (max-width:950px){.btBOV{row-gap:calc(var(--gapSmall) / 1.5);grid-column:2 / span 2;}}/*!sc*/
data-styled.g67[id="sc-xqrh7l-4"]{content:"btBOV,"}/*!sc*/
.kGDLNh{-webkit-transition:color 300ms ease-out;transition:color 300ms ease-out;margin:calc(var(--gapSmall) - 0.66em) 0;}/*!sc*/
.kGDLNh.kGDLNh.kGDLNh{margin-top:-0.25em;line-height:1.1;}/*!sc*/
@media screen and (max-width:950px){.kGDLNh{margin:unset;}}/*!sc*/
@media screen and (max-width:768px){.kGDLNh{font-size:var(--baseMMobile);}}/*!sc*/
data-styled.g68[id="sc-xqrh7l-5"]{content:"kGDLNh,"}/*!sc*/
.ddTrlT{color:var(--baseTextColor);font-size:var(--baseS);text-transform:capitalize;}/*!sc*/
@media screen and (max-width:768px){.ddTrlT{font-size:var(--baseSMobile);}}/*!sc*/
data-styled.g69[id="sc-xqrh7l-6"]{content:"ddTrlT,"}/*!sc*/
.fZAsJA{color:var(--baseTextColor);font-size:var(--baseM);line-height:1.3;}/*!sc*/
data-styled.g70[id="sc-xqrh7l-7"]{content:"fZAsJA,"}/*!sc*/
.xJLGt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;grid-template-columns:auto auto;-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g71[id="sc-xqrh7l-8"]{content:"xJLGt,"}/*!sc*/
.LrxPg{--imgWidthHeight:25px;display:grid;grid-template-columns:var(--imgWidthHeight) auto;-webkit-column-gap:var(--gapSmall);column-gap:var(--gapSmall);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media screen and (max-width:950px){.LrxPg{--imgWidthHeight:20px;-webkit-column-gap:calc(var(--gapSmall) - 0.33em);column-gap:calc(var(--gapSmall) - 0.33em);grid-template-columns:var(--imgWidthHeight) auto;}}/*!sc*/
data-styled.g72[id="sc-xqrh7l-9"]{content:"LrxPg,"}/*!sc*/
.iffZNQ{width:var(--imgWidthHeight);height:var(--imgWidthHeight);}/*!sc*/
.iffZNQ img{border-radius:var(--imgWidthHeight);}/*!sc*/
data-styled.g73[id="sc-xqrh7l-10"]{content:"iffZNQ,"}/*!sc*/
.jPBtwP{display:grid;width:800px;grid-auto-flow:row;row-gap:var(--gapSmall);justify-items:center;}/*!sc*/
@media screen and (max-width:860px){.jPBtwP{justify-items:inherit;width:100%;}}/*!sc*/
data-styled.g74[id="sc-s7zm4x-0"]{content:"jPBtwP,"}/*!sc*/
.bpvCmE{display:grid;grid-template-columns:repeat(3,auto);-webkit-column-gap:var(--gapSmall);column-gap:var(--gapSmall);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:-webkit-max-content;width:-moz-max-content;width:max-content;}/*!sc*/
data-styled.g75[id="sc-s7zm4x-1"]{content:"bpvCmE,"}/*!sc*/
.ekyYBs{font-size:var(--baseM);}/*!sc*/
@media screen and (max-width:768px){.ekyYBs{font-size:var(--baseMMobile);}}/*!sc*/
data-styled.g76[id="sc-s7zm4x-2"]{content:"ekyYBs,"}/*!sc*/
.kxcoSD{--authorImgSize:60px;--sharingIconSize:35px;display:grid;grid-template-columns:auto auto;-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:var(--gapRegular) 0 calc(var(--gapRegular) * 2) calc(var(--sharingIconSize) + var(--gapRegular));}/*!sc*/
@media screen and (max-width:860px){.kxcoSD{width:100%;-webkit-align-items:left;-webkit-box-align:left;-ms-flex-align:left;align-items:left;margin:var(--gapRegular) 0 calc(var(--gapRegular) * 2) 0;grid-template-columns:1fr;}}/*!sc*/
data-styled.g77[id="sc-s7zm4x-3"]{content:"kxcoSD,"}/*!sc*/
.fkjxwo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;}/*!sc*/
@media screen and (max-width:860px){.fkjxwo{-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}/*!sc*/
data-styled.g78[id="sc-s7zm4x-4"]{content:"fkjxwo,"}/*!sc*/
.fgQKjD{height:var(--authorImgSize);width:var(--authorImgSize);border-radius:var(--authorImgSize);border:4px solid white;z-index:1;position:relative;}/*!sc*/
data-styled.g79[id="sc-s7zm4x-5"]{content:"fgQKjD,"}/*!sc*/
.bEnkwP{height:350px;border-radius:calc(var(--defaultRadius) * 2);width:var(--articleContainer);margin:calc(var(--authorImgSize) / 2 * -1) 0 0 0;}/*!sc*/
.bEnkwP img{border-radius:calc(var(--defaultRadius) * 2);}/*!sc*/
@media screen and (max-width:860px){.bEnkwP{width:calc(100% + calc(var(--globalPaddingLr) * 2));height:300px;border-radius:0;margin:calc(var(--authorImgSize) / 2 * -1) 0 0 calc(var(--globalPaddingLr) * -1);}.bEnkwP img{border-radius:0;}}/*!sc*/
@media screen and (max-width:768px){.bEnkwP{height:250px;}}/*!sc*/
data-styled.g80[id="sc-s7zm4x-6"]{content:"bEnkwP,"}/*!sc*/
.bgguCm{display:grid;grid-template-rows:repeat(3,1fr);row-gap:var(--gapRegular);height:-webkit-min-content;height:-moz-min-content;height:min-content;margin-top:calc(var(--authorImgSize) / 2);}/*!sc*/
@media screen and (max-width:860px){.bgguCm{grid-template-columns:repeat(3,1fr);grid-template-rows:1fr;width:-webkit-min-content;width:-moz-min-content;width:min-content;-webkit-column-gap:var(--gapRegular);column-gap:var(--gapRegular);}}/*!sc*/
data-styled.g81[id="sc-s7zm4x-7"]{content:"bgguCm,"}/*!sc*/
.cUuIiH{height:var(--sharingIconSize);width:var(--sharingIconSize);border-radius:var(--sharingIconSize);border:var(--borderRegular) solid var(--baseTextColor);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;-webkit-transition:200ms border linear;transition:200ms border linear;}/*!sc*/
.cUuIiH svg path{-webkit-transition:200ms fill linear;transition:200ms fill linear;fill:var(--baseTextColor);}/*!sc*/
@media (hover:hover){.cUuIiH:hover{border:var(--borderRegular) solid var(--primaryColor);}.cUuIiH:hover svg path{fill:var(--primaryColor);}}/*!sc*/
data-styled.g82[id="sc-s7zm4x-8"]{content:"cUuIiH,"}/*!sc*/
.fFhjXu{--widthHeight:0.33em;width:var(--widthHeight);height:var(--widthHeight);background:var(--baseTextColor);border-radius:0.33em;}/*!sc*/
@media screen and (min-width:621px) and (max-width:680px){.fFhjXu{display:none;}}/*!sc*/
data-styled.g83[id="sc-s7zm4x-9"]{content:"fFhjXu,"}/*!sc*/
.EPkfG{position:relative;width:-webkit-max-content;width:-moz-max-content;width:max-content;border-radius:var(--defaultRadius);text-transform:uppercase;font-size:var(--baseM);font-weight:600;line-height:1;white-space:nowrap;-webkit-letter-spacing:0.025em;-moz-letter-spacing:0.025em;-ms-letter-spacing:0.025em;letter-spacing:0.025em;padding:0.3em 0.5em 0.4em 0.5em;cursor:pointer;border:var(--borderRegular) solid var(--primaryColor);-webkit-transition:background 300ms ease-out,color 300ms ease-out;transition:background 300ms ease-out,color 300ms ease-out;}/*!sc*/
@media screen and (max-width:860px){.EPkfG{left:-0.25em;}}/*!sc*/
@media (hover:hover){.EPkfG:hover{background:var(--primaryColor);}.EPkfG:hover a{color:white;}}/*!sc*/
.EPkfG a{color:var(--primaryColor);}/*!sc*/
data-styled.g84[id="sc-s7zm4x-10"]{content:"EPkfG,"}/*!sc*/
.XLZzf{font-style:italic;margin-top:var(--gapRegular);font-size:var(--baseM);}/*!sc*/
data-styled.g85[id="sc-s7zm4x-11"]{content:"XLZzf,"}/*!sc*/
.dNSNiv{margin-bottom:var(--gapRegular);}/*!sc*/
.dNSNiv svg path{-webkit-transition:fill 300ms ease-out;transition:fill 300ms ease-out;}/*!sc*/
@media (hover:hover){.dNSNiv:hover svg path{fill:var(--primaryColor);}}/*!sc*/
data-styled.g86[id="sc-6pvz7j-0"]{content:"dNSNiv,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">[운영체제][OSTEP] 락 — CTWC 블로그</title><link data-react-helmet="true" rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link data-react-helmet="true" rel="icon" href="/favicon-32.png" type="image/png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="192x192" href="/images/icon-192.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="512x512" href="/images/icon-512.png"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="sc-ocb3rv-0 dddcZz"><div class="sc-ocb3rv-1 SZAri"><a style="display:flex" aria-label="CTWC 블로그" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><path d="M823.058,231.951a15,15,0,1,1,15-15,3.838,3.838,0,1,1-7.676,0,7.327,7.327,0,1,0-7.327,7.327q.262,0,.522-.018a12.919,12.919,0,0,0,7.673,5.254A15,15,0,0,1,823.058,231.951Z" transform="translate(-808.058 -201.951)" fill="var(--primaryColor)"></path></svg></a><nav class="sc-ocb3rv-2 lgzEwb"><ul class="sc-ocb3rv-3 eMWcoN"><li><a href="/blog">블로그</a></li><li class="sc-4aeesa-0 dbHbus"><button aria-label="범주" aria-controls="categories_list" aria-expanded="false" class="sc-4aeesa-1 gavkVi">범주<span class="sc-4aeesa-2 ibbwvZ">›</span></button><ul id="categories_list" class="sc-4aeesa-3 cDqTDt"><li class="sc-4aeesa-4 hZEFWV"><a class="sc-4aeesa-5 iRHJDZ" href="/blog/daily-life">일상</a></li><li class="sc-4aeesa-4 hZEFWV"><a class="sc-4aeesa-5 iRHJDZ" href="/blog/algorithm">알고리즘 공부</a></li><li class="sc-4aeesa-4 hZEFWV"><a class="sc-4aeesa-5 iRHJDZ" href="/blog/development">개발 공부</a></li><li class="sc-4aeesa-4 hZEFWV"><a class="sc-4aeesa-5 iRHJDZ" href="/blog/chit-chat">사담</a></li><li class="sc-4aeesa-4 hZEFWV"><a class="sc-4aeesa-5 iRHJDZ" href="/blog/travel">여행</a></li><a class="sc-4aeesa-6 gylzxj" href="/categories">모든 카테고리 보기 →</a></ul></li><li><a href="/about-me">저에 대하여</a></li><li><a href="/contact">연락처</a></li></ul></nav><div class="sc-ocb3rv-4 hpyiIq"><button role="switch" aria-checked="false" aria-label="Dark mode" class="sc-r8riu4-0 eigRi"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18.005" style="width:20px;height:20px"><path fill="var(--baseTextColor)" d="M9.096 18.005A9.1 9.1 0 012.662 2.47 9.313 9.313 0 016.914.044 1.212 1.212 0 017.242 0a1.262 1.262 0 011.164 1.756 5.821 5.821 0 001.056 6.779 5.778 5.778 0 004.113 1.7 5.838 5.838 0 002.622-.626.743.743 0 01.174-.062 1.262 1.262 0 011.207.263 1.267 1.267 0 01.374 1.3 9.287 9.287 0 01-2.42 4.229 9.038 9.038 0 01-6.436 2.666zM6.842 1.606a7.894 7.894 0 00-3.13 1.916 7.613 7.613 0 1010.767 10.766 7.825 7.825 0 001.91-3.129 7.334 7.334 0 01-2.814.565 7.255 7.255 0 01-5.164-2.138 7.284 7.284 0 01-1.569-7.98z"></path></svg></button><span class="sc-ocb3rv-5 kWpURc"></span><nav class="sc-1cpn2c5-0 ixJjbe"><ul class="sc-1cpn2c5-1 gzssFe"><li class="sc-1cpn2c5-2 fnugyN"><span class="sc-1cpn2c5-3 geuSbO">ko</span></li><li class="sc-1cpn2c5-2 fnugyN"><a class="sc-1cpn2c5-3 khIuEb" href="/en/blog">en</a></li></ul></nav><span class="sc-ocb3rv-5 oCqE"></span><div class="sc-10pcvyt-0 dCTwrf"><button aria-label="메뉴 열기" class="sc-44p2kd-0 dTDcKG"><span class="sc-44p2kd-1 drgnVa"></span><span class="sc-44p2kd-1 drgnVa"></span><span class="sc-44p2kd-1 drgnVa"></span></button><nav class="sc-10pcvyt-1 fnzgpr"><ul class="sc-10pcvyt-2 iACCRi"><li class="sc-10pcvyt-4 czjcBe"><button role="switch" aria-checked="false" aria-label="Dark mode" class="sc-r8riu4-0 epnDCc"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18.005" style="width:20px;height:20px"><path fill="var(--baseTextColor)" d="M9.096 18.005A9.1 9.1 0 012.662 2.47 9.313 9.313 0 016.914.044 1.212 1.212 0 017.242 0a1.262 1.262 0 011.164 1.756 5.821 5.821 0 001.056 6.779 5.778 5.778 0 004.113 1.7 5.838 5.838 0 002.622-.626.743.743 0 01.174-.062 1.262 1.262 0 011.207.263 1.267 1.267 0 01.374 1.3 9.287 9.287 0 01-2.42 4.229 9.038 9.038 0 01-6.436 2.666zM6.842 1.606a7.894 7.894 0 00-3.13 1.916 7.613 7.613 0 1010.767 10.766 7.825 7.825 0 001.91-3.129 7.334 7.334 0 01-2.814.565 7.255 7.255 0 01-5.164-2.138 7.284 7.284 0 01-1.569-7.98z"></path></svg></button></li><li class="sc-10pcvyt-3 vehsg"><a class="sc-10pcvyt-5 rXwHW" href="/blog">블로그</a><span class="sc-10pcvyt-9 jvfMuW"></span></li><li class="sc-10pcvyt-3 vehsg"><button aria-controls="mobile_categories_list" aria-expanded="false" class="sc-10pcvyt-6 ePYRgY">범주<span class="sc-10pcvyt-10 dRxvTw">›</span></button><ul id="mobile_categories_list" class="sc-10pcvyt-12 gjrpoj"><li class="sc-10pcvyt-7 fNkHNw"><a class="sc-10pcvyt-8 ggXheO" href="/blog/daily-life">일상</a></li><li class="sc-10pcvyt-7 fNkHNw"><a class="sc-10pcvyt-8 ggXheO" href="/blog/algorithm">알고리즘 공부</a></li><li class="sc-10pcvyt-7 fNkHNw"><a class="sc-10pcvyt-8 ggXheO" href="/blog/development">개발 공부</a></li><li class="sc-10pcvyt-7 fNkHNw"><a class="sc-10pcvyt-8 ggXheO" href="/blog/chit-chat">사담</a></li><li class="sc-10pcvyt-7 fNkHNw"><a class="sc-10pcvyt-8 ggXheO" href="/blog/travel">여행</a></li><a class="sc-10pcvyt-11 dEebeF" href="/categories">모든 카테고리 보기 →</a></ul><span class="sc-10pcvyt-9 jvfMuW"></span></li><li class="sc-10pcvyt-3 vehsg"><a class="sc-10pcvyt-5 rXwHW" href="/about-me">저에 대하여</a><span class="sc-10pcvyt-9 jvfMuW"></span></li><li class="sc-10pcvyt-3 vehsg"><a class="sc-10pcvyt-5 rXwHW" href="/contact">연락처</a></li></ul></nav></div></div><hr class="sc-1fa65t8-8 ieohLm"/></div></header><main><article class="sc-1fa65t8-0 ieCpoN"><a aria-label="블로그로 돌아가기" class="sc-6pvz7j-0 dNSNiv" href="/blog"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><g transform="translate(-234.88 -235.072)"><path fill="var(--baseTextColor)" d="M258.317 249.568v1.983H245.6l3.215 3.215-1.4 1.4-5.61-5.606 5.608-5.609 1.4 1.4-3.213 3.217z"></path><path fill="var(--baseTextColor)" d="M249.88 237.072a13 13 0 109.193 3.807 12.915 12.915 0 00-9.193-3.807m0-2a15 15 0 11-15 15 15 15 0 0115-15z"></path></g></svg></a><header class="sc-s7zm4x-0 jPBtwP"><h2 class="sc-s7zm4x-10 EPkfG"><a href="/blog/development">개발 공부</a></h2><div class="sc-s7zm4x-1 bpvCmE"><address class="sc-s7zm4x-2 ekyYBs">손승열(Son Seungyeol)</address><span class="sc-s7zm4x-9 fFhjXu"></span><time class="sc-s7zm4x-2 ekyYBs">2023년 8월 17일</time></div><h1 class="sc-xcp2je-1 sc-xcp2je-3 kTTpgy dzBDzs">[운영체제][OSTEP] 락</h1><p class="sc-xcp2je-2 sc-xcp2je-4 gOHTsl kHLwub">임계 영역에서의 원자적인 실행을 위한 락에 대해 공부해봅니다.</p><time class="sc-s7zm4x-11 XLZzf">업데이트됨: 2023년 8월 22일 오후 10:47</time></header><div class="sc-s7zm4x-3 kxcoSD"><div class="sc-s7zm4x-4 fkjxwo"><div data-gatsby-image-wrapper="" style="visibility:" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-s7zm4x-5 fgQKjD"><div style="max-width:60px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;60&#x27; width=&#x27;60&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgWEQ8LDhgYDhUNDhgNDw8NFxUdGBYfFhUaHysjGikoHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OHBANHDUcIig7NS81NS81MjUvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAFAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAABQYHAv/EAB4QAAICAgMBAQAAAAAAAAAAAAABAgMFBgQRQXEi/8QAFQEBAQAAAAAAAAAAAAAAAAAABAP/xAAaEQACAwEBAAAAAAAAAAAAAAAAAQIDEhMR/9oADAMBAAIRAxEAPwDT8/1LHSK/r67scevSfz99VXBkm/Cva/zKle/pCc/JoRXWsFujxvygcLI1pAXqQTmjONm2RzpceyCwmwxpsbbADWJdBFbeCfe2wXoAGpIL6z//2Q==" alt=""/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 60px) 60px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77" data-srcset="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 60px) 60px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77" srcSet="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-s7zm4x-6 bEnkwP"><div style="max-width:860px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;430&#x27; width=&#x27;860&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLCgoLDhMVDhcNDh0VDxUSGhYdHSIVFhUaKysjGh0oHSEWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLCgUFEBAOEC8oIhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAwAGAMBIgACEQEDEQH/xAAYAAEAAwEAAAAAAAAAAAAAAAAFAQQGAP/EAB0QAAEEAgMAAAAAAAAAAAAAAAEAAgMEESEFEjL/xAAWAQADAAAAAAAAAAAAAAAAAAAAAQP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDD1KM1uPLjpIRUI4GZc4aRXH25hTOHqqbth7yDIVIiXI2IQzqCoREhL/RyuQH/2Q==" alt=""/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 860px) 860px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;w=860" data-srcset="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.25&amp;w=860 215w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.5&amp;w=860 430w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;w=860 860w" alt="[운영체제][OSTEP] 락"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 860px) 860px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;w=860" srcSet="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.25&amp;w=860 215w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.5&amp;w=860 430w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;w=860 860w" alt="[운영체제][OSTEP] 락"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><aside class="sc-s7zm4x-7 bgguCm"><a rel="noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=undefined" class="sc-s7zm4x-8 cUuIiH"><svg xmlns="http://www.w3.org/2000/svg" width="8.304" height="16.608" viewBox="0 0 8.304 16.608"><title>Facebook</title><path fill="white" d="M8.076 5.536H6V8.3h2.076v8.3h3.46V8.3h2.52l.244-2.764h-2.764V4.382c0-.661.133-.922.772-.922h2V0h-2.639C9.18 0 8.076 1.1 8.076 3.194z" transform="translate(-6)"></path></svg></a><a rel="noreferrer" target="_blank" href="https://twitter.com/share?url=undefined" class="sc-s7zm4x-8 cUuIiH"><svg xmlns="http://www.w3.org/2000/svg" width="15.69" height="12.751" viewBox="0 0 15.69 12.751"><title>Twitter</title><path fill="white" d="M15.69 3.758a6.427 6.427 0 01-1.849.507 3.224 3.224 0 001.415-1.781 6.448 6.448 0 01-2.044.781A3.221 3.221 0 007.727 6.2a9.138 9.138 0 01-6.635-3.363 3.223 3.223 0 001 4.3 3.205 3.205 0 01-1.457-.4 3.221 3.221 0 002.582 3.2 3.226 3.226 0 01-1.454.055 3.221 3.221 0 003.007 2.235A6.472 6.472 0 010 13.553 9.113 9.113 0 004.934 15a9.1 9.1 0 009.149-9.575 6.554 6.554 0 001.607-1.667z" transform="translate(0 -2.248)"></path></svg></a><a rel="noreferrer" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=undefined" class="sc-s7zm4x-8 cUuIiH"><svg xmlns="http://www.w3.org/2000/svg" width="13.598" height="13.032" viewBox="0 0 13.598 13.032"><title>Linkedin</title><path fill="white" d="M2.822 2.416A1.405 1.405 0 111.416 1a1.411 1.411 0 011.406 1.416zm.011 2.55H0v9.065h2.833zm4.523 0H4.541v9.065h2.815V9.273c0-2.646 3.416-2.862 3.416 0v4.759H13.6V8.291c0-4.465-5.055-4.3-6.243-2.1V4.966z" transform="translate(0 -1)"></path></svg></a></aside></div><div class="sc-1tn1m5t-1 dYCkih"><h2>1️⃣ 락: 기본 개념</h2><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>balance </span><span class="token" style="color:#EDEDED">=</span><span> balance </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span></code></pre></div><p>위와 같은 임계 영역을 다음과 같이 락으로 감싼 상황을 가정해보자.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> mutex</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 글로벌 변수로 선언된 락</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#c5c8c6">.</span><span>
</span><span></span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>balance </span><span class="token" style="color:#EDEDED">=</span><span> balance </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span></code></pre></div><p>위의 코드에서 나타나는 특징들을 하나씩 살펴보자.</p><h3>락은 하나의 변수이다.</h3><p>락을 사용하기 위해서는 <mark>락 변수를 먼저 선언</mark>해야 한다.</p><p>락 변수는 <mark>락의 상태</mark>를 나타낸다.<br/>✅ <mark>사용 가능(available) 상태</mark>(해제(unlocked) 또는 free): 어느 쓰레드도 락을 갖고 있지 않은 상태<br/>🚫 <mark>사용 중(acquired)</mark>: 임계 영역에서 정확히 하나의 쓰레드가 락을 획득한 상태</p><p>락 자료 구조에 락을 보유한 쓰레드에 대한 정보나 락을 대기하는 쓰레드들에 대한 정보를 저장할 수도 있음.<br/>➡️ 단, 락 사용자는 이러한 정보를 알 수 없음.</p><h3>lock( )과 unlock( ) 루틴</h3><p>🔒 <code>lock()</code> 루틴 호출을 통해 락 획득을 시도<br/>➡️ 만약 어떤 쓰레드도 락을 갖고 있지 않다면, 락을 획득하여 임계 영역 내로 진입<br/>➡️ 임계 영역 내로 진입한 쓰레드를 락 <mark>소유자(owner)</mark>라고 부름.<br/>➡️ 락이 이미 사용 중이라면, <code>lock()</code> 함수가 리턴하지 않음.</p><p>🔓 락 소유자가 <code>unlock()</code>을 호출<br/>➡️ 락은 다시 사용 가능한 상태가 됨.<br/>➡️ <code>lock()</code> 호출 후 대기 중이던 쓰레드가 있다면, 락을 획득하여 임계 영역 내로 진입</p><p>락은 프로그래머에게 스케줄링에 대한 최소한의 제어권을 제공</p><p>일반적으로 쓰레드는 프로그래머가 생성하고 운영체제가 제어<br/>➡️ 락은 쓰레드에 대한 제어권을 일부 이양 받을 수 있도록 해줌.</p><p>💡 <mark>락으로 코드를 감싸서</mark> 프로그래머는 <mark>그 코드 내에서는 하나의 쓰레드만 동작하도록 보장</mark></p><hr/><h2>2️⃣ Pthread 락</h2><h3>Mutex</h3><p>쓰레드 간에 <mark>상호 배제(mutual exclusion)</mark> 기능을 제공하므로 POSIX 라이브러리는 락을 <mark>mutex</mark>라고 부름.</p><h3>POSIX의 락 사용 방식</h3><p>POSIX 방식에서는 <mark>변수 명을 지정하여 락과 언락 함수에 전달</mark><br/>➡️ 다른 변수를 보호하기 위해서 <u>다른 락</u>을 사용할 수도 있기 때문<br/>➡️ 💡 세밀한 락 사용 전략</p><p>[<mark>거친(coarse-grained)</mark> 락 사용 전략]<br/>하나의 락이 임의의 임계 영역에 진입할 때마다 사용</p><p>[<mark>세밀한(fine-grained)</mark> 락 사용 전략]<br/>서로 다른 데이터와 자료 구조를 보호하기 위해 여러 락을 사용<br/>➡️ 한 번에 여러 쓰레드가 서로 다른 락으로 보호된 코드 내에 각자가 진입 가능</p><hr/><h2>3️⃣ 락 구현</h2><p>효율적인 락 = 낮은 비용 + 상호 배제 기법 제공 &amp; 몇 가지 속성들</p><p><mark>사용 가능한 락</mark>을 만들기 위해서 <mark>하드웨어와 운영체제의 도움</mark>을 받아야 함.</p><p>정교한 락 라이브러리를 제작하는 데 있어 운영체제가 관여하는 것은 무엇인지 알아보자.</p><hr/><h2>4️⃣ 락의 평가</h2><p>락이 (잘) 동작하는지 평가하기 위한 기준을 정해야 한다.</p><h3><mark>상호 배제</mark>를 제대로 지원하는가</h3><p>락의 가장 기본적인 역할이다.</p><p>기본적으로 락이 동작하여 임계 영역 내로 <mark>다수의 쓰레드가 진입하는 것을 막을 수 있는지 검사</mark>해야 한다.</p><h3><mark>공정성(fairness)</mark></h3><p>쓰레드들이 락 획득에 있어 공정한 기회가 주어지는지 확인해야 한다.</p><p>이 문제의 다른 관점: 좀 더 극단적인 상황을 평가<br/>➡️ 락을 전혀 얻지 못해 <mark>굶주리는(starve)</mark> 경우가 발생하는가?</p><h3><mark>성능(performance)</mark></h3><p>특히, 락 사용 시간적 오버헤드를 평가해야 한다.</p><p>⛏️ 경쟁이 전혀 없는 경우</p><ul><li><p>하나의 쓰레드가 실행 중에 락을 획득하고 해제하는 과정에서 발생하는 부하는 얼마나 되는가?</p></li></ul><p>⚔️ 여러 쓰레드가 단일 CPU 상에서 락을 획득하려고 경쟁하는 상황</p><p>♟️ 멀티 CPU 상황에서 락 경쟁 시의 성능</p><p>이처럼 서로 다른 상황의 성능을 평가하여야 다양한 락 기법들이 성능에 미치는 영향을 이해할 수 있음.</p><hr/><h2>5️⃣ 인터럽트 제어</h2><p>초창기 단일 프로세스 시스템<br/>➡️ 상호 배제 지원을 위해 임계 영역 내에서는 <mark>인터럽트를 비활성화</mark>하는 방법을 사용</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">DisableInterrupts</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">EnableInterrupts</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>이 경우 임계 영역 내의 코드에서는 인터럽트가 발생할 수 없기 때문에 <mark>원자적으로 실행</mark>될 수 있음.</p><p>✅ 주요 장점: 단순하다.<br/>인터럽트가 발생하지 않으면, 코드가 실행 중에 다른 쓰레드가 중간에 끼어들지 않는다는 것을 보장</p><p>⚠️ 단점1: 이를 요청하는 쓰레드에게 인터럽트 활성/비활성 <mark>특권(privileged)</mark> 연산 허가<br/>쓰레드가 이를 다른 목적으로 사용하지 않음을 <u>신뢰</u>해야 함.<br/>➡️ 탐욕적(Greedy) 기법을 사용한 프로그램이 시작과 동시에 <code>lock()</code>을 호출하여 프로세서를 독점하는 경우..</p><p>⚠️ 단점2: 멀티프로세서에서는 적용 불가<br/>여러 쓰레드가 여러 CPU에서 실행 중인 경우 각 쓰레드가 동일한 임계 영역에 진입하려고 시도할 수 있음.<br/>➡️ 특정 프로세서의 인터럽트 비활성화는 <mark>다른 프로세서에서 실행 중인 프로그램에는 전혀 영향을 주지 않음.</mark></p><p>⚠️ 단점3: 인터럽트의 장시간 중지는 중요한 인터럽트의 시점을 놓칠 수 있음.<br/>때로는 시스템에 심각한 문제를 가져 올 수 있음.<br/>➡️ CPU가 저장 장치에서 읽기 요청을 마친 사실을 모르고 지나간다면 이를 기다리고 있는 프로세스는 언제 깨울 수 있을까..</p><p>⚠️ 단점4: 비효율적이다.<br/>일반적인 명령어의 실행에 비해 인터럽트를 비활성화시키는 코드들은 최신의 CPU들에서는 느리게 실행되는 경향이 있음.</p><p>💡 따라서 상호 배제를 위한 인터럽트 비활성화는 제한된 범위에서만 사용되어야 한다.<br/>➡️ 운영체제가 내부 자료 구조에 대한 원자적 연산을 위해 인터럽트를 비활성화하는 등<br/>➡️ 운영체제 내부에서는 신뢰라는 문제가 사라지므로 용인 가능</p><hr/><h2>6️⃣ Test-And-Set (Atomic Exchange)</h2><p>멀티프로세서에서는 인터럽트를 중지시키는 것이 의미가 없음.<br/>➡️ 시스템 설계자들은 락 지원을 위한 하드웨어를 설계하기 시작함.</p><p>💡 <mark>Test-And-Set</mark> 명령어 또는 <mark>원자적 교체(atomic exchange)</mark><br/>➡️ 하드웨어 기법 중 기장 기본적인 기법</p><p>이해를 위해 먼저 아래의 코드를 살펴보자.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">typedef</span><span> </span><span class="token" style="color:#96CBFE">struct</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">__lock_t</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> </span><span class="token" style="color:#96CBFE">int</span><span> flag</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">init</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 0 −&gt; 락이 사용 가능함, 1 -&gt; 락 사용 중</span><span>
</span><span>  mutex−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// flag 변수를 검사(TEST) 함</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// spin−wait (do nothing)</span><span>
</span><span>  mutex−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 이제 설정(SET) 한다!</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  mutex−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>💡 간단한 변수(<code>flag</code>)를 사용하여 쓰레드가 락을 획득하였는지를 나타낸다.</p><p>그러나 위의 코드에는 두 가지 문제가 있다.</p><p>⚠️ 문제1: 정확성<br/>위의 예시에서 적시에 인터럽트가 발생하면 두 쓰레드 모두 플래그를 1로 설정하는 경우가 생길 수 있음.<br/>➡️ 임계 영역에 두 쓰레드가 다 진입할 수 있음.<br/>➡️ 🚫 상호 배제 제공 실패</p><p>⚠️ 문제2: 성능<br/>사용 중인 락을 대기할 때 <mark>spin-wait</mark>라는 방법을 사용<br/>➡️ 플래그의 값을 무한히 검사하므로, 다른 쓰레드가 락을 해제할 때까지 시간을 낭비<br/>➡️ 특히, 단일 프로세서에서 매우 손해가 큼.(적어도 문맥 교환이 있기 전까지는 락을 소유한 쓰레드조차 실행X)</p><hr/><h2>7️⃣ 진짜 돌아가는 스핀 락의 구현</h2><p>앞선 아이디어는 하드웨어 지원 없이는 동작이 불가능<br/>➡️ 일부 시스템은 이 개념에 근간한 락 구현을 위한 (어셈블리) 명령어를 제공</p><p>아래와 같이 시스템마다 명령어의 이름은 다르지만,</p><ul><li><p>SPARC: <code>ldstub</code>(<code>load/store unsigned byte</code> 동작)</p></li><li><p>x86: <code>xchg</code>(원자적 교체 명령어)</p></li></ul><p>기본적으로 동일한 일을 수행하며 일반적으로 <mark>Test-And-Set</mark>라고 불린다.</p><p>다음의 C 코드의 일부를 사용하여 <code>TestAndSet</code>의 동작을 정의해 보자.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#DAD085">TestAndSet</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>old_ptr</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#96CBFE">int</span><span> new</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> old </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>old_ptr</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// old_ptr의 이전 값을 가져옴</span><span>
</span><span>  </span><span class="token" style="color:#EDEDED">*</span><span>old_ptr </span><span class="token" style="color:#EDEDED">=</span><span> new</span><span class="token" style="color:#c5c8c6">;</span><span>     </span><span class="token" style="color:#7C7C7C">// old_ptr에 &#x27;new&#x27;의 값을 저장함</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">return</span><span> old</span><span class="token" style="color:#c5c8c6">;</span><span>         </span><span class="token" style="color:#7C7C7C">// old의 값을 반환함</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>위의 코드를 통해 &quot;test and set&quot;이라고 불리는 이유를 알 수 있다.<br/>➡️ &quot;test&quot;하는(반환되는 값) 동시에 메모리에 새로운 값을 &quot;set&quot;하기 때문</p><p>✅ 핵심은 이 동작들이 <mark>원자적으로 수행</mark>된다는 것</p><p>이제 6️⃣의 예시 코드에서 <code>lock()</code> 함수를 다음과 같이 재작성하여 간단한 스핀 락(spin lock)을 만들 수 있다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">TestAndSet</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 스핀(아무 일도 하지 않음)</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>💡 위의 락이 동작하는 이유를 다시 짚어보자.</p><ol><li><p>한 쓰레드가 <code>lock()</code> 요청 시 아직 다른 어떤 쓰레드도 락을 보유하고 있지 않고 있음.</p><ol><li><p><code>flag</code> 값은 0</p></li></ol></li><li><p>해당 쓰레드가 <code>TestAndSet(flag, 1)</code>을 호출</p><ol><li><p><code>TestAndSet()</code>은 <code>flag</code>의 이전 값인 0을 반환</p></li></ol></li><li><p><code>flag</code> 값을 검사한 쓰레드는 <code>while</code> 문에서 <mark>회전하지 않고 락 획득</mark></p></li><li><p><mark>해당 쓰레드는 </mark><code><mark>flag</mark></code><mark> 값을 1로 설정하여 락을 보유하고 있음을 표시</mark></p></li><li><p><mark>임계 영역 내의 동작을 끝마치면 </mark><code><mark>unlock()</mark></code><mark>을 호출하여 </mark><code><mark>flag</mark></code><mark>를 다시 0으로 변경</mark></p></li></ol><p>락이 사용 중이어서 flag 값이 1인 경우의 동작도 생각해보자.</p><ol><li><p>쓰레드가 <code>lock()</code>을 호출하여 <code>TestAndSet(flag, 1)</code> 루틴을 실행한다.</p></li><li><p>이미 락을 다른 쓰레드가 보유하고 있으므로 예전 값으로 1을 반환하는 동시에 <code>flag</code>의 값을 다시 1로 설정한다.</p><ol><li><p>락을 보유하고 있는 쓰레드가 있는 한 <code>TestAndSet</code>는 계속 1을 반환</p></li><li><p>대기 중인 쓰레드는 락이 해제될 때까지 계속 <code>while</code> 문을 반복</p></li></ol></li><li><p>락을 보유하고 있던 쓰레드가 <code>flag</code> 값을 0으로 변경</p></li><li><p>대기 중이던 쓰레드가 <code>TestAndSet()</code>를 호출하여 0을 받는 동시에 원자적으로 값을 1로 변경</p></li><li><p>임계 영역으로 진입</p></li></ol><p>✅ 락의 값을 검사(test)하고 새로운 값으로 설정(set)하는 동작을 원자적 연산으로 만듦으로써 오직 하나의 쓰레드만 락을 획득할 수 있도록 만듦.</p><p>💡 <mark>스핀 락</mark></p><ul><li><p>가장 기초적인 형태의 락</p></li><li><p>락을 획득할 때까지, CPU 사이클을 소모하면서 회전</p></li><li><p>단일 프로세서에서 이 방식을 제대로 사용하려면 선점형 스케줄러(preemptive scheduler)를 사용하여야 함.</p><ul><li><p>선점형 스케줄러는 필요에 따라 다른 쓰레드가 실행될 수 있도록 타이머를 통해 쓰레드에 인터럽트를 발생시킬 수 있음.</p></li><li><p>선점형 스케줄러가 아니라면 while 문을 회전하여 대기하는 쓰레드가 CPU를 영원히 독점</p></li></ul></li></ul><hr/><h2>8️⃣ 스핀 락 평가</h2><p>락에서 가장 중요한 측면은 상호 배제의 <mark>정확성<br/></mark>➡️ 스핀 락은 임의의 시간에 단 하나의 쓰레드만이 임계 영역에 진입할 수 있도록 함.</p><p>하지만 스핀 락은 어떠한 <mark>공정성</mark>도 보장해줄 수 없음.<br/>➡️ while 문을 회전 중인 쓰레드는 경쟁에서 밀려 계속 그 상태에 남아 있을 수 있음.</p><p><mark>성능</mark>을 평가하기 위해서는 몇 가지 경우를 생각해보아야 함.</p><ol><li><p>단일 프로세서를 사용할 때 락을 획득하기 위해 경쟁하는 경우</p><ol><li><p>스핀 락이 갖는 성능 오버헤드는 상당히 클 수 있음.</p></li><li><p>스케줄러가 락을 대기 중인 쓰레드들을 하나씩 깨우는 경우 할당받은 기간 동안 CPU 사이클을 낭비하면서 락을 획득하기 위해 대기</p></li></ol></li><li><p>여러 프로세서에 쓰레드가 퍼져 있는 경우</p><ol><li><p>스핀 락은 꽤 합리적으로 동작</p></li><li><p>락을 대기 중인 쓰레드가 락을 사용 중인 쓰레드와 다른 CPU에서 실행 중인 경우 <code>while</code> 문을 회전하면서 대기하는 것은 그렇게 많은 사이클을 낭비하지 않음.</p></li></ol></li></ol><hr/><h2>9️⃣ Compare-And-Swap</h2><p>또 다른 하드웨어 기법으로 <mark>Compare-And-Swap</mark>(SPARC)/<mark>Compare-And-Exchange</mark>(x86)가 있다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#DAD085">CompareAndSwap</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#96CBFE">int</span><span> expected</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#96CBFE">int</span><span> new</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> actual </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>actual </span><span class="token" style="color:#EDEDED">==</span><span> expected</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>    </span><span class="token" style="color:#EDEDED">*</span><span>ptr </span><span class="token" style="color:#EDEDED">=</span><span> new</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">return</span><span> actual</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>💡 기본 개념은 <code>ptr</code>이 가리키고 있는 주소의 값이 <code>expected</code> 변수와 일치하는지 검사<br/>➡️ ✅ 만약 일치한다면 <code>ptr</code>이 가리키는 주소의 값을 새로운 값으로 변경<br/>➡️ 🚫 불일치한다면 아무 것도 하지 않음.</p><p>위 방법은 Test-And-Set 방법과 동일한 방식으로 락을 만들 수 있음.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">CompareAndSwap</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 회전</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>동작 또한 Test-And-Set과 유사하다.</p><ul><li><p><code>flag</code> 변수가 0인지 검사하고 만약 그렇다면 자동적으로 1로 바꾸어 락을 획득</p></li><li><p>다른 쓰레드가 락을 보유하고 있다면, 획득할 때까지 <code>while</code> 문에서 회전</p></li></ul><p><code>CompareAndSwap</code> 명령어는 <code>TestAndSet</code> 명령어보다 더 강력<br/>➡️ <mark>대기없는 동기화(wait-free synchronization)</mark>를 다룰 때 진가가 나타남.</p><hr/><h2>🔟 Load-Linked 그리고 Store-Conditional</h2><p>어떤 플랫폼은 임계 영역 진입 제어 함수를 제작하기 위한 명령어 쌍을 제공</p><p>MIPS 구조에서는 <mark>load-linked</mark>와 <mark>store-conditional</mark> 명령어를 앞뒤로 사용하여 락이나 기타 병행 연산을 위한 자료 구조를 만들 수 있음.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#DAD085">LoadLinked</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#DAD085">StoreConditional</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#96CBFE">int</span><span> value</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>no one has updated </span><span class="token" style="color:#EDEDED">*</span><span>ptr since the LoadLinked to this address</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#EDEDED">*</span><span>ptr </span><span class="token" style="color:#EDEDED">=</span><span> value</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 성공!</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#96CBFE">else</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 갱신을 실패함</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p><code>load-linked</code>: 일반 로드 명령어와 같이 메모리 값을 레지스터에 저장</p><p><code>store-conditional</code>: 동일한 주소에 다른 스토어가 없었던 경우에만 저장을 성공<br/>➡️ 저장이 성공하면, <code>load-linked</code>가 탑재했던 값을 갱신<br/>➡️ ✅ 성공한 경우에는 <code>ptr</code>이 가리키는 <code>value</code>의 값을 갱신하고 1을 반환<br/>➡️ 🚫 실패한 경우에는 갱신없이 0을 반환</p><p>다음은 <code>load-linked</code>와 <code>store-conditional</code>을 사용하여 락을 만드는 방법이다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">LoadLinked</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#7C7C7C">// 0이 될 때까지 스핀</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">StoreConditional</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>      </span><span class="token" style="color:#96CBFE">return</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 1로 변경하는 것이 성공하였다면: 완료</span><span>
</span><span>              </span><span class="token" style="color:#7C7C7C">// 아니라면: 처음부터 다시 시도</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p><code>lock()</code> 부분의 동작 순서는 다음과 같다.</p><ol><li><p>쓰레드가 <code>while</code> 문을 돌며 <code>flag</code>가 0(락의 해제)이 되기를 기다린다.</p></li><li><p>락이 획득 가능한 상태가 되면 쓰레드는 <code>store-conditional</code> 명령어로 락 획득을 시도한다.</p><ol><li><p>✅ 성공 하는 경우</p><ol><li><p>쓰레드는 <code>flag</code> 값을 1로 변경하고 임계 영역 내로 진입한다.</p></li></ol></li><li><p>🚫 실패 하는 경우</p><ol><li><p>다시 락을 획득할 수 있을 때까지 기다린다.</p></li></ol></li></ol></li></ol><p>⭐ 그럼 이렇게 <code>store-conditional</code> 명령어가 실패하는 경우를 살펴보자.</p><p>쓰레드가 <code>lock()</code>을 호출하여 <code>load-linked</code>를 통해 0을 반환 받은 후 <mark><code>store-conditional</code></mark><mark> 명령어를 시도하기 전에 인터럽트</mark>에 걸린다고 생각해보자.</p><p>이때 다른 쓰레드가 <code>store-conditional</code>을 통해 락 획득에 성공한다면?<br/>➡️<code>store-conditional</code>은 <mark>오직 하나의 쓰레드만 </mark><code><mark>flag</mark></code><mark> 값을 1로 설정 후 락을 획득</mark>할 수 있도록 하므로 인터럽트에 걸린 쓰레드는 다음 기회를 기다릴 수 밖에 없다.(즉, 실패) 😓</p><p>아래와 같이 <code>lock()</code>을 조금 더 간결하게 작성할 수 있다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">LoadLinked</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#EDEDED">!</span><span class="token" style="color:#DAD085">StoreConditional</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>flag</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 회전</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><hr/><h2>1️⃣1️⃣ Fetch-And-Add</h2><p><code>Fetch-And-Add</code> 명령어는 <mark>원자적으로 특정 주소의 예전 값을 반환하면서 값을 증가</mark>시킨다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#DAD085">FetchAndAdd</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> old </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>ptr</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#EDEDED">*</span><span>ptr </span><span class="token" style="color:#EDEDED">=</span><span> old </span><span class="token" style="color:#EDEDED">+</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">return</span><span> old</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>🎟️ <mark>티켓 락</mark><br/>Mellor-Crummey와 Scott이 제안한 것으로, 하나의 변수 만을 사용하는 대신 <mark>티켓(ticket)과 차례(turn) 조합을 사용하여 락</mark>을 만든다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">typedef</span><span> </span><span class="token" style="color:#96CBFE">struct</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">__lock_t</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> ticket</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> turn</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock_init</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>ticket </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>turn </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> myturn </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">FetchAndAdd</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>ticket</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>turn </span><span class="token" style="color:#EDEDED">!=</span><span> myturn</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 회전</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>lock</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">FetchAndAdd</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>lock−</span><span class="token" style="color:#EDEDED">&gt;</span><span>turn</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>하나의 쓰레드가 락 획득을 원할 때, fetch-and-add(원자적으로 동작)를 실행한다.<br/>➡️ <mark>결과 값은 해당 쓰레드의 &quot;차례&quot;(myturn)</mark>을 나타낸다.<br/>➡️ <code>myturn == lock-&gt;turn</code>(전역 공유 변수) 조건에 부합하면 임계 영역에 진입</p><p><code>unlock()</code> 동작은 차례 변수의 값을 증가시켜서 대기 중인 다음 쓰레드가 존재한다면 임계 영역의 진입 차례를 넘겨준다.</p><p>💡 이전까지의 접근 방법과 다른 점은 <mark>모든 쓰레드들이 각자의 순서에 따라 진행</mark>한다는 것<br/>➡️ 쓰레드가 티켓 값을 할당받았다면 미래의 어느 때에 실행되기 위해 스케줄되어 있다는 것</p><p>이전의 Test-And-Set의 경우 다른 쓰레드들은 락을 획득/해제하더라도 어떤 쓰레드는 계속 회전만하고 있을 수 있음.</p><hr/><h2>1️⃣2️⃣ 요약: 과도한 스핀</h2><p>지금까지의 하드웨어 기반 락 ➡️ 간단하고 제대로 동작하지만, 효율적이지 않은 경우도 있음.</p><p>N개의 쓰레드가 프로세서가 하나인 시스템에서 실행하는 경우</p><ol><li><p>한 쓰레드가 <mark>락을 보유한 상태에서 인터럽트</mark>에 걸림.</p></li><li><p>다음 차례의 쓰레드는 락 획득을 시도 시 스핀 시작</p></li><li><p>다른 N-1 개의 쓰레드들 또한 할당된 CPU 시간 동안 비슷한 이유로 낭비</p></li><li><p>다시 락을 보유한 쓰레드 차례가 되면 락을 해제</p></li></ol><p>하드웨어의 지원으로만은 이 문제를 해결할 수 없다.<br/>➡️ <mark>운영체제로부터의 지원</mark>이 추가로 필요</p><hr/><h2>1️⃣3️⃣ 간단한 접근법: 무조건 양보!</h2><p>첫 번째 시도 ➡️ 락이 해제되기를 기다리며 스핀해야 하는 경우 <mark>자신에게 할당된 CPU를 다른 쓰레드에게 양보</mark></p><p>다음은 Test-And-Set에 양보를 이용한 락을 적용한 코드이다.<br/>➡️ 운영체제에 자신이 할당받은 CPU 시간을 포기하고 다른 쓰레드가 실행될 수 있도록 하는 <code>yield()</code> 기법이 있다고 가정</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">init</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">TestAndSet</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>flag</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>    </span><span class="token" style="color:#DAD085">yield</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// CPU를 양보함</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>하나의 쓰레드는 다음과 같은 상태를 가질 수 있다.</p><ul><li><p>실행 중(running)</p></li><li><p>준비(ready)</p></li><li><p>막힘(blocked)</p></li></ul><p>양보(yield) 시스템 콜은 <mark>호출 쓰레드 상태를 실행 중(running) 상태에서 준비(ready) 상태로 변환</mark>하여 <mark>다른 쓰레드가 실행 중 상태로 전이</mark>하도록 한다.<br/>➡️ 양보 동작은 스케줄 대상에서 자신을 빼는 것(<mark>deschedule</mark>)이나 마찬가지</p><p>⚠️ 단일 CPU에서 100개 정도의 쓰레드들이 락 획득을 위해 경쟁하는 경우<br/>나머지 99개의 쓰레드가 각자 <code>lock()</code>을 호출하고 CPU를 양보<br/>➡️ round-robin 스케줄러 사용 시 99개의 쓰레드가 run-and-yield 패턴으로 동작<br/>➡️ ✅ 99개의 시간 간격을 낭비하게 되는 회전 방식보다는 좀 더 좋음<br/>➡️ 🚫 여전히 문맥 교환 비용이 상당하며 낭비가 많음.<br/>➡️ 🚫 굶주림 문제(이 경우 무한한 양보)는 아직 고려하고 있지도 않음.</p><hr/><h2>1️⃣4️⃣ 큐의 사용: 스핀 대신 잠자기</h2><p>어떤 쓰레드가 다음으로 락을 획득할지를 명시적으로 제어할 수 있어야 함.<br/>➡️ <mark>운영체제제로부터 적절한 지원과 큐를 이용한 대기 쓰레드들의 관리가 필요</mark></p><p>Solaris의 방식을 통해 이를 알아보자.</p><p>아래와 같은 두 개의 호출문이 있다.</p><ul><li><p><code>park()</code>: 호출하는 쓰레드를 잠재우는 함수</p></li><li><p><code>unpark(threadID)</code>: threadID로 명시된 특정 쓰레드를 깨우는 함수</p></li></ul><p>💡 위의 두 루틴은 이미 사용 중인 락을 요청하는 프로세스를 재우고 해당 락이 해제되면 깨우도록 하는 락을 제작하는 데 사용될 수 있다.</p><p>다음 예시에서 두 가지를 시도해보자.</p><ol><li><p>Test-And-Set 개념을 락 대기자 전용 큐와 함께 사용하여 좀 더 효율적인 락을 제작</p></li><li><p>큐를 통해 다음 락 획득 대상을 제어하여 기아 현상을 피할 수 있도록 함.</p></li></ol><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">typedef</span><span> </span><span class="token" style="color:#96CBFE">struct</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">__lock_t</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> flag</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> guard</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#FFFFB6;text-decoration:underline">queue_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>q</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock_init</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>m</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">queue_init</span><span class="token" style="color:#c5c8c6">(</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>q</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">lock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>m</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">TestAndSet</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 회전하면서 guard 락을 획득</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 락을 획득함</span><span>
</span><span>    m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token" style="color:#96CBFE">else</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#DAD085">queue_add</span><span class="token" style="color:#c5c8c6">(</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>q</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#DAD085">gettid</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#DAD085">park</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">unlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FFFFB6;text-decoration:underline">lock_t</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>m</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">TestAndSet</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">&amp;</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">// 회전하면서 guard 락을 획득</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">queue_empty</span><span class="token" style="color:#c5c8c6">(</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>q</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>    m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>flag </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 락을 포기함: 누구도 락을 원치 않음</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">else</span><span>
</span><span>    </span><span class="token" style="color:#DAD085">unpark</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">queue_remove</span><span class="token" style="color:#c5c8c6">(</span><span>m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>q</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span> </span><span class="token" style="color:#7C7C7C">// 락을 획득함(다음 쓰레드를 위해!)</span><span>
</span><span>  m</span><span class="token" style="color:#EDEDED">-&gt;</span><span>guard </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>위의 코드에서 나타나는 특징들을 살펴보자.</p><p>[🛡️ <code>guard</code> 변수 ➡️ <code>flag</code>, 큐의 삽입/삭제 동작을 스핀락으로 보호하는 데 사용]</p><ul><li><p>이 방법은 회전 대기를 완전히 배제하지는 못했음.</p></li><li><p>쓰레드는 락을 획득하거나 해제하는 과정에서 인터럽트에 걸릴 수 있음.</p><p>➡️ 다른 쓰레드는 락의 해제를 기다리며 회전 대기하게 됨.</p></li><li><p><mark>사용자가 지정한 임계 영역에 진입하는 것이 아닌, 락과 언락 코드 내의 몇 개의 명령어만 수행하면 되므로 회전 대기 시간은 꽤 짧음.</mark> ➡️ 합리적</p></li></ul><p>[🔒 <code>lock()</code> 내에 추가된 동작]</p><ul><li><p><code>lock()</code> 호출 시 다른 쓰레드가 이미 락을 보유한 경우</p><ul><li><p><code>gettid()</code>를 호출하여 현재 실행 중인 쓰레드의 ID를 얻음</p></li><li><p>락 소유자의 큐에 자기 자신을 추가</p></li><li><p><code>guard</code> 변수를 0으로 변경한 후에 CPU를 양보</p></li></ul></li></ul><p>[☀️ 다른 쓰레드가 깨어났을 때 <code>flag</code> 변수가 0으로 설정되어 있지 않음.]</p><ul><li><p>쓰레드가 깨어날 때는 마치 쓰레드가 <code>park()</code>에서 리턴하는 것과 같이 보임.</p></li><li><p>하지만 그 시점에서 <code>guard</code> 락을 획득한 상태가 아님.</p><ul><li><p><code>flag</code> 변수의 값을 1로 변경하는 것을 시도조차 할 수 없음.</p></li></ul></li><li><p>락을 획득하려는 다음 쓰레드로 직접 전달</p><ul><li><p>그 사이에 <code>flag</code>는 0으로 바뀌지 않음.</p></li></ul></li></ul><p>[⚔️ <code>park()</code> 직전에 경쟁 조건이 발생]</p><ul><li><p>한 쓰레드가 락이 사용 중인 이유로 <code>park()</code> 문을 수행하려는 상황</p><ul><li><p>만약 그 직전에 락 소유자한테 CPU가 할당되는 경우 ➡️ ⚠️ 문제 발생</p></li><li><p>락을 보유한 쓰레드가 해당 락을 해제함.</p></li><li><p>처음의 쓰레드가 <code>park()</code>를 수행하면 (잠재적으로) 깨어날 방법이 없음.</p><p>➡️ <mark>깨우기/대기 경쟁(wakeup/waiting race)</mark></p></li></ul></li><li><p><mark>Solaris는 이 문제를 </mark><code><mark>setpark()</mark></code><mark> 시스템 콜을 추가하여 해결</mark></p><ul><li><p><mark>이 루틴은 </mark><code><mark>park()</mark></code><mark>를 호출하기 직전이라는 것을 표시</mark></p></li><li><p><mark>이때 인터럽트가 수행되고 </mark><code><mark>park()</mark></code><mark> 호출 전 다른 쓰레드가 </mark><code><mark>unpark()</mark></code><mark>를 먼저 호출</mark></p><p>➡️ <code>park()</code> 문은 sleep 하는 대신 바로 리턴</p></li></ul></li></ul><p><code>lock()</code> 내에 다음과 같이 <code>setpark()</code>를 추가하여 깨우기/대기 경쟁 문제를 해결한다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU"></div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>queue_add(m−&gt;q, gettid());
</span>setpark(); // 새로운 코드
<!-- -->m−&gt;guard = 0;</code></pre></div><p><code>guard</code> 변수의 역할을 커널에서 담당하는 것도 하나의 방법<br/>➡️ 커널은 락 해제와 실행 중인 쓰레드를 큐에서 제거하는 동작을 원자적으로 처리하기 위해 주의해야 함.</p><hr/><h2>1️⃣5️⃣ 다른 운영체제, 다른 지원</h2><h3>Linux</h3><p><mark>futex</mark>라는 것을 지원</p><p>futex는 특정 물리 메모리 주소와 연결되어 있으며 futex마다 커널 내부의 큐를 갖고 있음.</p><p>호출자는 futex를 호출하여 필요에 따라 잠을 자거나 깨어날 수 있음.</p><p>futex에는 두 개의 명령어가 제공됨.</p><ul><li><p><code>futex_wait(address, expected)</code></p><ul><li><p>address 값과 expected 값이 동일한 경우 쓰레드를 잠재움.</p></li><li><p>같지 않은 경우 즉시 리턴함.</p></li></ul></li><li><p><code>futex_wake(address)</code></p><ul><li><p>큐에서 대기하고 있는 쓰레드 하나를 깨움.</p></li></ul></li></ul><p><code><mark>nptl</mark></code> 라이브러리의 <mark><code>lowlevellock.h</code></mark>(gnu libc 라이브러리의 일부)를 살펴보자.</p><ul><li><p>하나의 정수를 이용하여 락의 사용 중 여부(최상위 비트), 대기자 수(나머지 비트)를 표현</p><ul><li><p>만약 락이 음수라면 락이 사용 중인 것을 나타냄.</p></li></ul></li><li><p>경쟁이 없는 일반적인 경우에 대한 최적화 방법을 제시</p><ul><li><p>단 하나의 쓰레드가 락을 획득하고 해제하는 경우</p><p>➡️ 원자적으로 비트 단위의 TestAndSet로 락을 획득하고 원자적 덧셈을 하여 락을 해제</p></li></ul></li></ul><hr/><h2>1️⃣6️⃣ 2단계 락</h2><p>Linux의 기법에는 1960년 초에 있었던 Dahm 락을 시작으로 지금까지 간혹 사용되던 오래된 기법이 녹아있음.<br/>➡️ 요즘은 <mark>2단계 락(two-phase lock)</mark>이라고 불림.</p><p>💡 락이 곧 해제될 것 같은 경우라면 회전 대기가 유용할 수 있다는 것에서 착안한 기법이다.</p><div style="position:relative"><div class="sc-1tn1m5t-2 bEOXNU">c</div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code class="language-c" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">mutex_lock</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">int</span><span> v</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">/* 31번째 비트가 이미 초기화되어 있다. mutex를 이미 획득했다.
</span><span class="token" style="color:#7C7C7C">    바로 리턴한다. (이것이 빠르게 실행하는 방법이다) */</span><span> 
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">atomic_bit_test_set</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">31</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">return</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">atomic_increment</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#FF73FD">1</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">atomic_bit_test_set</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">31</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">==</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>      </span><span class="token" style="color:#DAD085">atomic_decrement</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>      </span><span class="token" style="color:#96CBFE">return</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span>    </span><span class="token" style="color:#7C7C7C">/* 이제 대기해야 한다. 먼저, 우리가 관찰 중인 futex 값이
</span><span class="token" style="color:#7C7C7C">      실제로 음수 인지 확인해야 한다(잠겨있는 상태인지). */</span><span>
</span><span>    v </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>v </span><span class="token" style="color:#EDEDED">&gt;=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>      </span><span class="token" style="color:#96CBFE">continue</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>    </span><span class="token" style="color:#DAD085">futex_wait</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">,</span><span> v</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span>
<span></span><span class="token" style="color:#96CBFE">void</span><span> </span><span class="token" style="color:#DAD085">mutex_unlock</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#96CBFE">int</span><span> </span><span class="token" style="color:#EDEDED">*</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span><span>  </span><span class="token" style="color:#7C7C7C">/* 필요충분 조건으로 관심 대상의 다른 쓰레드가 없는 경우에 한해서
</span><span class="token" style="color:#7C7C7C">    0x80000000를 카운터에 더하면 0을 얻는다. */</span><span>
</span><span>  </span><span class="token" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">atomic_add_zero</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#FF73FD">0x80000000</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span>
</span><span>    </span><span class="token" style="color:#96CBFE">return</span><span class="token" style="color:#c5c8c6">;</span><span>
</span>  
<span>  </span><span class="token" style="color:#7C7C7C">/* 이 mutex를 기다리는 다른 쓰레드가 있다면
</span><span class="token" style="color:#7C7C7C">    그 쓰레드들을 깨운다. */</span><span>
</span><span>  </span><span class="token" style="color:#DAD085">futex_wake</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>mutex</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span><span></span><span class="token" style="color:#c5c8c6">}</span></code></pre></div><p>첫 번째 단계 ➡️ 곧 락을 획득할 수 있을 것이라는 기대로 회전하며 기다린다.</p><p>두 번째 단계 ➡️ 첫 번째 단계에서 락을 획득하지 못했다면 sleep 했다가 락이 해제된 후에 깨어난다.</p><p>앞서 본 Linux의 락은 이러한 형태를 갖는 락이지만 한 번만 회전<br/>➡️ 일반화된 방법은 futex가 잠재우기 전에 일정 시간 동안 반복문 내에서 회전하도록 하는 것</p><p>💡 2단계 락은 두 개의 좋은 개념을 사용하여 개선된 하나를 만들어 내는 하이브리드 방식의 일종<br/>➡️ 하드웨어 환경, 쓰레드의 개수, 세부 작업량 등에 의존성이 있으므로 항상 좋다고 보기는 어려움.</p><hr/><h2>📚 참고 문헌</h2><p><a target="_blank" href="https://pages.cs.wisc.edu/~remzi/OSTEP/threads-locks.pdf">Operating Systems: Three Easy Pieces ― 28: Locks</a></p><p><a target="_blank" href="https://pages.cs.wisc.edu/~remzi/OSTEP/Korean/28_threads-locks.pdf">운영체제 아주 쉬운 세 가지 이야기 ― 31: 락</a></p></div></article><section class="sc-1fa65t8-0 dVgTdY"><header class="sc-1fa65t8-5 cawStE"><h1 class="sc-xcp2je-1 sc-xcp2je-5 kTTpgy iAerpu">관련있는 게시물</h1></header><div class="sc-1fa65t8-2 cZKuCp"><article><a class="sc-xqrh7l-0 bbUTbE" href="/blog/development/os-thread-api"><div class="sc-xqrh7l-1 bWoXQo"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-xqrh7l-2 jWsskh"><div style="max-width:300px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;120&#x27; width=&#x27;300&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:cover"></div><picture><source media="(max-width: 950px)" data-srcset="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.06&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 25w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.12&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 50w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.24&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 100w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.47&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 200w" sizes="(min-width: 300px) 300px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 300px) 300px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860" data-srcset="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.09&amp;w=860 75w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.18&amp;w=860 150w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860 300w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.7&amp;w=860 600w" alt="[운영체제][OSTEP] 쓰레드 API"/></picture><noscript><picture><source media="(max-width: 950px)" srcSet="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.06&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 25w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.12&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 50w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.24&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 100w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.47&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 200w" sizes="(min-width: 300px) 300px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 300px) 300px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860" srcSet="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.09&amp;w=860 75w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.18&amp;w=860 150w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860 300w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.7&amp;w=860 600w" alt="[운영체제][OSTEP] 쓰레드 API"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div class="sc-xqrh7l-4 btBOV"><span class="sc-xqrh7l-3 cetJnl">개발 공부</span><time class="sc-xqrh7l-6 ddTrlT">2023년 8월 17일</time><h1 class="sc-xcp2je-7 sc-xqrh7l-5 kWxtIT kGDLNh">[운영체제][OSTEP] 쓰레드 API</h1><p class="sc-xqrh7l-7 fZAsJA">쓰레드 API를 이용하여 쓰레드를 생성하고 제어하는 방법에 대해 공부해봅니다</p><footer class="sc-xqrh7l-8 xJLGt"><div class="sc-xqrh7l-9 LrxPg"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-xqrh7l-10 iffZNQ"><div style="max-width:30px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;30&#x27; width=&#x27;30&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:cover"></div><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 30px) 30px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77" data-srcset="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.11&amp;w=77 8w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 30px) 30px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77" srcSet="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.11&amp;w=77 8w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><address class="sc-xqrh7l-6 ddTrlT">손승열(Son Seungyeol)</address></div></footer></div></a></article><article><a class="sc-xqrh7l-0 bbUTbE" href="/blog/development/os-locked-data-structure"><div class="sc-xqrh7l-1 bWoXQo"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-xqrh7l-2 jWsskh"><div style="max-width:300px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;120&#x27; width=&#x27;300&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:cover"></div><picture><source media="(max-width: 950px)" data-srcset="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.06&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 25w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.12&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 50w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.24&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 100w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.47&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 200w" sizes="(min-width: 300px) 300px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 300px) 300px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860" data-srcset="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.09&amp;w=860 75w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.18&amp;w=860 150w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860 300w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.7&amp;w=860 600w" alt="[운영체제][OSTEP] 락 기반의 병행 자료 구조"/></picture><noscript><picture><source media="(max-width: 950px)" srcSet="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.06&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 25w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.12&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 50w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.24&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 100w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?ar=1&amp;auto=format&amp;crop=focalpoint&amp;dpr=0.47&amp;fit=crop&amp;fp-x=0.5&amp;fp-y=0.5&amp;w=430 200w" sizes="(min-width: 300px) 300px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 300px) 300px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860" srcSet="https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.09&amp;w=860 75w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.18&amp;w=860 150w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.35&amp;w=860 300w,https://www.datocms-assets.com/66479/1686988115-ostep.jpg?auto=format&amp;dpr=0.7&amp;w=860 600w" alt="[운영체제][OSTEP] 락 기반의 병행 자료 구조"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><div class="sc-xqrh7l-4 btBOV"><span class="sc-xqrh7l-3 cetJnl">개발 공부</span><time class="sc-xqrh7l-6 ddTrlT">2023년 8월 25일</time><h1 class="sc-xcp2je-7 sc-xqrh7l-5 kWxtIT kGDLNh">[운영체제][OSTEP] 락 기반의 병행 자료 구조</h1><p class="sc-xqrh7l-7 fZAsJA">자료 구조에 락을 추가하여 쓰레드 사용에 안전한 구조를 만드는 방법에 대해 공부해봅니다.</p><footer class="sc-xqrh7l-8 xJLGt"><div class="sc-xqrh7l-9 LrxPg"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained sc-xqrh7l-10 iffZNQ"><div style="max-width:30px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;30&#x27; width=&#x27;30&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;object-fit:cover"></div><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 30px) 30px, 100vw" decoding="async" loading="lazy" data-src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77" data-srcset="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.11&amp;w=77 8w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="object-fit:cover;opacity:0" sizes="(min-width: 30px) 30px, 100vw" decoding="async" loading="lazy" src="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77" srcSet="https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.11&amp;w=77 8w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.2&amp;w=77 15w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.39&amp;w=77 30w,https://www.datocms-assets.com/66479/1649735652-kakaotalk_20220412_124457267.jpg?auto=format&amp;dpr=0.78&amp;w=77 60w" alt="손승열(Son Seungyeol)"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><address class="sc-xqrh7l-6 ddTrlT">손승열(Son Seungyeol)</address></div></footer></div></a></article></div></section></main><footer class="sc-1fa65t8-0 dVgTdY"><hr class="sc-1fa65t8-8 ieohKG"/><div class="sc-14wwzx0-0 lfShgD"><div class="sc-14wwzx0-1 imCxOf"><p>Made with React, Gatsby and DatoCMS by <a rel="noreferrer" target="_blank" href="https://github.com/smastrom/">@smastrom</a></p><p>Contribute or star on <a rel="noreferrer" target="_blank" href="https://github.com/smastrom/headless-gatsby-multilang">GitHub</a></p></div><div class="sc-14wwzx0-2 gEkEYr"><p>© 2022-2023 손승열 for 🅒🅞🅝🅣🅔🅝🅣🅢</p><p>모두 좋은 하루 보내세요! 😊</p></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-H6EJ4TNHBT"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-H6EJ4TNHBT'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = true;

    var options = {
      send_page_view: false
    };
    if (true) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-H6EJ4TNHBT', options);
  </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/development/os-locks";window.___webpackCompilationHash="2812c6277b420f7b2ddc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ab7fd8f01db0d2b13bf3.js"],"app":["/app-f6c17ef09a4baf8559f6.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-6fbf7fb4a5c27452ac29.js"],"component---src-templates-article-jsx":["/component---src-templates-article-jsx-3a9ac3605b72ba299126.js"],"component---src-templates-blog-root-jsx":["/component---src-templates-blog-root-jsx-7e7adc53eb94d7fb0bd8.js"],"component---src-templates-categories-archive-jsx":["/component---src-templates-categories-archive-jsx-2a66b6cae7d5ab15d824.js"],"component---src-templates-category-jsx":["/component---src-templates-category-jsx-f5b60a562159eba77f60.js"],"component---src-templates-home-jsx":["/component---src-templates-home-jsx-82bd06b9171ac6294783.js"],"component---src-templates-other-pages-jsx":["/component---src-templates-other-pages-jsx-3d76ebaca87bca138e1f.js"]};/*]]>*/</script><script src="/polyfill-ab7fd8f01db0d2b13bf3.js" nomodule=""></script><script src="/app-f6c17ef09a4baf8559f6.js" async=""></script><script src="/framework-77401c81af1d0c515d3d.js" async=""></script><script src="/webpack-runtime-127ff0323c2f0662aa60.js" async=""></script></body></html>